---
title: COleControl 类
ms.date: 08/27/2018
f1_keywords:
- COleControl
- AFXCTL/COleControl
- AFXCTL/COleControl::COleControl
- AFXCTL/COleControl::AmbientAppearance
- AFXCTL/COleControl::AmbientBackColor
- AFXCTL/COleControl::AmbientDisplayName
- AFXCTL/COleControl::AmbientFont
- AFXCTL/COleControl::AmbientForeColor
- AFXCTL/COleControl::AmbientLocaleID
- AFXCTL/COleControl::AmbientScaleUnits
- AFXCTL/COleControl::AmbientShowGrabHandles
- AFXCTL/COleControl::AmbientShowHatching
- AFXCTL/COleControl::AmbientTextAlign
- AFXCTL/COleControl::AmbientUIDead
- AFXCTL/COleControl::AmbientUserMode
- AFXCTL/COleControl::BoundPropertyChanged
- AFXCTL/COleControl::BoundPropertyRequestEdit
- AFXCTL/COleControl::ClientToParent
- AFXCTL/COleControl::ClipCaretRect
- AFXCTL/COleControl::ControlInfoChanged
- AFXCTL/COleControl::DisplayError
- AFXCTL/COleControl::DoClick
- AFXCTL/COleControl::DoPropExchange
- AFXCTL/COleControl::DoSuperclassPaint
- AFXCTL/COleControl::EnableSimpleFrame
- AFXCTL/COleControl::ExchangeExtent
- AFXCTL/COleControl::ExchangeStockProps
- AFXCTL/COleControl::ExchangeVersion
- AFXCTL/COleControl::FireClick
- AFXCTL/COleControl::FireDblClick
- AFXCTL/COleControl::FireError
- AFXCTL/COleControl::FireEvent
- AFXCTL/COleControl::FireKeyDown
- AFXCTL/COleControl::FireKeyPress
- AFXCTL/COleControl::FireKeyUp
- AFXCTL/COleControl::FireMouseDown
- AFXCTL/COleControl::FireMouseMove
- AFXCTL/COleControl::FireMouseUp
- AFXCTL/COleControl::FireReadyStateChange
- AFXCTL/COleControl::GetActivationPolicy
- AFXCTL/COleControl::GetAmbientProperty
- AFXCTL/COleControl::GetAppearance
- AFXCTL/COleControl::GetBackColor
- AFXCTL/COleControl::GetBorderStyle
- AFXCTL/COleControl::GetCapture
- AFXCTL/COleControl::GetClassID
- AFXCTL/COleControl::GetClientOffset
- AFXCTL/COleControl::GetClientRect
- AFXCTL/COleControl::GetClientSite
- AFXCTL/COleControl::GetControlFlags
- AFXCTL/COleControl::GetControlSize
- AFXCTL/COleControl::GetDC
- AFXCTL/COleControl::GetEnabled
- AFXCTL/COleControl::GetExtendedControl
- AFXCTL/COleControl::GetFocus
- AFXCTL/COleControl::GetFont
- AFXCTL/COleControl::GetFontTextMetrics
- AFXCTL/COleControl::GetForeColor
- AFXCTL/COleControl::GetHwnd
- AFXCTL/COleControl::GetMessageString
- AFXCTL/COleControl::GetNotSupported
- AFXCTL/COleControl::GetReadyState
- AFXCTL/COleControl::GetRectInContainer
- AFXCTL/COleControl::GetStockTextMetrics
- AFXCTL/COleControl::GetText
- AFXCTL/COleControl::GetWindowlessDropTarget
- AFXCTL/COleControl::InitializeIIDs
- AFXCTL/COleControl::InternalGetFont
- AFXCTL/COleControl::InternalGetText
- AFXCTL/COleControl::InternalSetReadyState
- AFXCTL/COleControl::InvalidateControl
- AFXCTL/COleControl::InvalidateRgn
- AFXCTL/COleControl::IsConvertingVBX
- AFXCTL/COleControl::IsModified
- AFXCTL/COleControl::IsOptimizedDraw
- AFXCTL/COleControl::IsSubclassedControl
- AFXCTL/COleControl::Load
- AFXCTL/COleControl::LockInPlaceActive
- AFXCTL/COleControl::OnAmbientPropertyChange
- AFXCTL/COleControl::OnAppearanceChanged
- AFXCTL/COleControl::OnBackColorChanged
- AFXCTL/COleControl::OnBorderStyleChanged
- AFXCTL/COleControl::OnClick
- AFXCTL/COleControl::OnClose
- AFXCTL/COleControl::OnDoVerb
- AFXCTL/COleControl::OnDraw
- AFXCTL/COleControl::OnDrawMetafile
- AFXCTL/COleControl::OnEdit
- AFXCTL/COleControl::OnEnabledChanged
- AFXCTL/COleControl::OnEnumVerbs
- AFXCTL/COleControl::OnEventAdvise
- AFXCTL/COleControl::OnFontChanged
- AFXCTL/COleControl::OnForeColorChanged
- AFXCTL/COleControl::OnFreezeEvents
- AFXCTL/COleControl::OnGetColorSet
- AFXCTL/COleControl::OnGetControlInfo
- AFXCTL/COleControl::OnGetDisplayString
- AFXCTL/COleControl::OnGetInPlaceMenu
- AFXCTL/COleControl::OnGetNaturalExtent
- AFXCTL/COleControl::OnGetPredefinedStrings
- AFXCTL/COleControl::OnGetPredefinedValue
- AFXCTL/COleControl::OnGetViewExtent
- AFXCTL/COleControl::OnGetViewRect
- AFXCTL/COleControl::OnGetViewStatus
- AFXCTL/COleControl::OnHideToolBars
- AFXCTL/COleControl::OnInactiveMouseMove
- AFXCTL/COleControl::OnInactiveSetCursor
- AFXCTL/COleControl::OnKeyDownEvent
- AFXCTL/COleControl::OnKeyPressEvent
- AFXCTL/COleControl::OnKeyUpEvent
- AFXCTL/COleControl::OnMapPropertyToPage
- AFXCTL/COleControl::OnMnemonic
- AFXCTL/COleControl::OnProperties
- AFXCTL/COleControl::OnQueryHitPoint
- AFXCTL/COleControl::OnQueryHitRect
- AFXCTL/COleControl::OnRenderData
- AFXCTL/COleControl::OnRenderFileData
- AFXCTL/COleControl::OnRenderGlobalData
- AFXCTL/COleControl::OnResetState
- AFXCTL/COleControl::OnSetClientSite
- AFXCTL/COleControl::OnSetData
- AFXCTL/COleControl::OnSetExtent
- AFXCTL/COleControl::OnSetObjectRects
- AFXCTL/COleControl::OnShowToolBars
- AFXCTL/COleControl::OnTextChanged
- AFXCTL/COleControl::OnWindowlessMessage
- AFXCTL/COleControl::ParentToClient
- AFXCTL/COleControl::PostModalDialog
- AFXCTL/COleControl::PreModalDialog
- AFXCTL/COleControl::RecreateControlWindow
- AFXCTL/COleControl::Refresh
- AFXCTL/COleControl::ReleaseCapture
- AFXCTL/COleControl::ReleaseDC
- AFXCTL/COleControl::ReparentControlWindow
- AFXCTL/COleControl::ResetStockProps
- AFXCTL/COleControl::ResetVersion
- AFXCTL/COleControl::ScrollWindow
- AFXCTL/COleControl::SelectFontObject
- AFXCTL/COleControl::SelectStockFont
- AFXCTL/COleControl::SerializeExtent
- AFXCTL/COleControl::SerializeStockProps
- AFXCTL/COleControl::SerializeVersion
- AFXCTL/COleControl::SetAppearance
- AFXCTL/COleControl::SetBackColor
- AFXCTL/COleControl::SetBorderStyle
- AFXCTL/COleControl::SetCapture
- AFXCTL/COleControl::SetControlSize
- AFXCTL/COleControl::SetEnabled
- AFXCTL/COleControl::SetFocus
- AFXCTL/COleControl::SetFont
- AFXCTL/COleControl::SetForeColor
- AFXCTL/COleControl::SetInitialSize
- AFXCTL/COleControl::SetModifiedFlag
- AFXCTL/COleControl::SetNotPermitted
- AFXCTL/COleControl::SetNotSupported
- AFXCTL/COleControl::SetRectInContainer
- AFXCTL/COleControl::SetText
- AFXCTL/COleControl::ThrowError
- AFXCTL/COleControl::TransformCoords
- AFXCTL/COleControl::TranslateColor
- AFXCTL/COleControl::WillAmbientsBeValidDuringLoad
- AFXCTL/COleControl::WindowProc
- AFXCTL/COleControl::DrawContent
- AFXCTL/COleControl::DrawMetafile
- AFXCTL/COleControl::IsInvokeAllowed
- AFXCTL/COleControl::SetInitialDataFormats
helpviewer_keywords:
- COleControl [MFC], COleControl
- COleControl [MFC], AmbientAppearance
- COleControl [MFC], AmbientBackColor
- COleControl [MFC], AmbientDisplayName
- COleControl [MFC], AmbientFont
- COleControl [MFC], AmbientForeColor
- COleControl [MFC], AmbientLocaleID
- COleControl [MFC], AmbientScaleUnits
- COleControl [MFC], AmbientShowGrabHandles
- COleControl [MFC], AmbientShowHatching
- COleControl [MFC], AmbientTextAlign
- COleControl [MFC], AmbientUIDead
- COleControl [MFC], AmbientUserMode
- COleControl [MFC], BoundPropertyChanged
- COleControl [MFC], BoundPropertyRequestEdit
- COleControl [MFC], ClientToParent
- COleControl [MFC], ClipCaretRect
- COleControl [MFC], ControlInfoChanged
- COleControl [MFC], DisplayError
- COleControl [MFC], DoClick
- COleControl [MFC], DoPropExchange
- COleControl [MFC], DoSuperclassPaint
- COleControl [MFC], EnableSimpleFrame
- COleControl [MFC], ExchangeExtent
- COleControl [MFC], ExchangeStockProps
- COleControl [MFC], ExchangeVersion
- COleControl [MFC], FireClick
- COleControl [MFC], FireDblClick
- COleControl [MFC], FireError
- COleControl [MFC], FireEvent
- COleControl [MFC], FireKeyDown
- COleControl [MFC], FireKeyPress
- COleControl [MFC], FireKeyUp
- COleControl [MFC], FireMouseDown
- COleControl [MFC], FireMouseMove
- COleControl [MFC], FireMouseUp
- COleControl [MFC], FireReadyStateChange
- COleControl [MFC], GetActivationPolicy
- COleControl [MFC], GetAmbientProperty
- COleControl [MFC], GetAppearance
- COleControl [MFC], GetBackColor
- COleControl [MFC], GetBorderStyle
- COleControl [MFC], GetCapture
- COleControl [MFC], GetClassID
- COleControl [MFC], GetClientOffset
- COleControl [MFC], GetClientRect
- COleControl [MFC], GetClientSite
- COleControl [MFC], GetControlFlags
- COleControl [MFC], GetControlSize
- COleControl [MFC], GetDC
- COleControl [MFC], GetEnabled
- COleControl [MFC], GetExtendedControl
- COleControl [MFC], GetFocus
- COleControl [MFC], GetFont
- COleControl [MFC], GetFontTextMetrics
- COleControl [MFC], GetForeColor
- COleControl [MFC], GetHwnd
- COleControl [MFC], GetMessageString
- COleControl [MFC], GetNotSupported
- COleControl [MFC], GetReadyState
- COleControl [MFC], GetRectInContainer
- COleControl [MFC], GetStockTextMetrics
- COleControl [MFC], GetText
- COleControl [MFC], GetWindowlessDropTarget
- COleControl [MFC], InitializeIIDs
- COleControl [MFC], InternalGetFont
- COleControl [MFC], InternalGetText
- COleControl [MFC], InternalSetReadyState
- COleControl [MFC], InvalidateControl
- COleControl [MFC], InvalidateRgn
- COleControl [MFC], IsConvertingVBX
- COleControl [MFC], IsModified
- COleControl [MFC], IsOptimizedDraw
- COleControl [MFC], IsSubclassedControl
- COleControl [MFC], Load
- COleControl [MFC], LockInPlaceActive
- COleControl [MFC], OnAmbientPropertyChange
- COleControl [MFC], OnAppearanceChanged
- COleControl [MFC], OnBackColorChanged
- COleControl [MFC], OnBorderStyleChanged
- COleControl [MFC], OnClick
- COleControl [MFC], OnClose
- COleControl [MFC], OnDoVerb
- COleControl [MFC], OnDraw
- COleControl [MFC], OnDrawMetafile
- COleControl [MFC], OnEdit
- COleControl [MFC], OnEnabledChanged
- COleControl [MFC], OnEnumVerbs
- COleControl [MFC], OnEventAdvise
- COleControl [MFC], OnFontChanged
- COleControl [MFC], OnForeColorChanged
- COleControl [MFC], OnFreezeEvents
- COleControl [MFC], OnGetColorSet
- COleControl [MFC], OnGetControlInfo
- COleControl [MFC], OnGetDisplayString
- COleControl [MFC], OnGetInPlaceMenu
- COleControl [MFC], OnGetNaturalExtent
- COleControl [MFC], OnGetPredefinedStrings
- COleControl [MFC], OnGetPredefinedValue
- COleControl [MFC], OnGetViewExtent
- COleControl [MFC], OnGetViewRect
- COleControl [MFC], OnGetViewStatus
- COleControl [MFC], OnHideToolBars
- COleControl [MFC], OnInactiveMouseMove
- COleControl [MFC], OnInactiveSetCursor
- COleControl [MFC], OnKeyDownEvent
- COleControl [MFC], OnKeyPressEvent
- COleControl [MFC], OnKeyUpEvent
- COleControl [MFC], OnMapPropertyToPage
- COleControl [MFC], OnMnemonic
- COleControl [MFC], OnProperties
- COleControl [MFC], OnQueryHitPoint
- COleControl [MFC], OnQueryHitRect
- COleControl [MFC], OnRenderData
- COleControl [MFC], OnRenderFileData
- COleControl [MFC], OnRenderGlobalData
- COleControl [MFC], OnResetState
- COleControl [MFC], OnSetClientSite
- COleControl [MFC], OnSetData
- COleControl [MFC], OnSetExtent
- COleControl [MFC], OnSetObjectRects
- COleControl [MFC], OnShowToolBars
- COleControl [MFC], OnTextChanged
- COleControl [MFC], OnWindowlessMessage
- COleControl [MFC], ParentToClient
- COleControl [MFC], PostModalDialog
- COleControl [MFC], PreModalDialog
- COleControl [MFC], RecreateControlWindow
- COleControl [MFC], Refresh
- COleControl [MFC], ReleaseCapture
- COleControl [MFC], ReleaseDC
- COleControl [MFC], ReparentControlWindow
- COleControl [MFC], ResetStockProps
- COleControl [MFC], ResetVersion
- COleControl [MFC], ScrollWindow
- COleControl [MFC], SelectFontObject
- COleControl [MFC], SelectStockFont
- COleControl [MFC], SerializeExtent
- COleControl [MFC], SerializeStockProps
- COleControl [MFC], SerializeVersion
- COleControl [MFC], SetAppearance
- COleControl [MFC], SetBackColor
- COleControl [MFC], SetBorderStyle
- COleControl [MFC], SetCapture
- COleControl [MFC], SetControlSize
- COleControl [MFC], SetEnabled
- COleControl [MFC], SetFocus
- COleControl [MFC], SetFont
- COleControl [MFC], SetForeColor
- COleControl [MFC], SetInitialSize
- COleControl [MFC], SetModifiedFlag
- COleControl [MFC], SetNotPermitted
- COleControl [MFC], SetNotSupported
- COleControl [MFC], SetRectInContainer
- COleControl [MFC], SetText
- COleControl [MFC], ThrowError
- COleControl [MFC], TransformCoords
- COleControl [MFC], TranslateColor
- COleControl [MFC], WillAmbientsBeValidDuringLoad
- COleControl [MFC], WindowProc
- COleControl [MFC], DrawContent
- COleControl [MFC], DrawMetafile
- COleControl [MFC], IsInvokeAllowed
- COleControl [MFC], SetInitialDataFormats
ms.assetid: 53e95299-38e8-447b-9c5f-a381d27f5123
ms.openlocfilehash: 54138955b0aa61a5e307c64825f3c74fa6f592b1
ms.sourcegitcommit: 7a6116e48c3c11b97371b8ae4ecc23adce1f092d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/22/2020
ms.locfileid: "81753936"
---
# <a name="colecontrol-class"></a>COleControl 类

用于开发 OLE 控件的重要基类。

## <a name="syntax"></a>语法

```
class COleControl : public CWnd
```

## <a name="members"></a>成员

### <a name="public-constructors"></a>公共构造函数

|名称|说明|
|----------|-----------------|
|[COle 控制：COle 控制](#colecontrol)|创建一个 `COleControl` 对象。|

### <a name="public-methods"></a>公共方法

|名称|说明|
|----------|-----------------|
|[COleControl：环境外观](#ambientappearance)|检索控件的当前外观。|
|[COle 控制：环境背面颜色](#ambientbackcolor)|返回环境 BackColor 属性的值。|
|[COleControl：环境显示名称](#ambientdisplayname)|返回容器指定的控件的名称。|
|[COleControl：环境字体](#ambientfont)|返回环境字体属性的值。|
|[COleControl：环境福彩](#ambientforecolor)|返回环境 ForeColor 属性的值。|
|[COleControl：环境区域ID](#ambientlocaleid)|返回容器的区域设置 ID。|
|[COle 控制：：环境尺度单位](#ambientscaleunits)|返回容器使用的单位类型。|
|[COle 控制：：环境显示抓手](#ambientshowgrabhandles)|确定是否应显示抓取控点。|
|[COle 控制：环境显示填充](#ambientshowhatching)|确定是否应显示剖面线。|
|[COle 控制：环境文本对齐](#ambienttextalign)|返回容器指定的文本对齐类型。|
|[COleControl：环境UIDead](#ambientuidead)|确定控件是否应响应用户界面操作。|
|[COle 控制：环境用户模式](#ambientusermode)|确定容器的模式。|
|[COle 控制：绑定属性已更改](#boundpropertychanged)|通知容器绑定属性已更改。|
|[COle 控制：：绑定属性请求编辑](#boundpropertyrequestedit)|请求编辑属性值的权限。|
|[COle 控制：：客户端到父级](#clienttoparent)|将相对于控件原点的点转换为相对于其容器源的点。|
|[COle 控制：：ClipCaretrect](#clipcaretrect)|如果倾斜矩形与控件重叠，则调整其矩形。|
|[COle 控制：：控制信息已更改](#controlinfochanged)|在控件处理的助记符集已更改后调用此函数。|
|[COleControl：:D播放错误](#displayerror)|向控件的用户显示库存错误事件。|
|[COleControl：:DoClick](#doclick)|实现库存`DoClick`方法。|
|[COleControl：:DoPropExchange](#dopropexchange)|序列化`COleControl`对象的属性。|
|[COleControl：:D超类绘画](#dosuperclasspaint)|重绘从 Windows 控件中子分类的 OLE 控件。|
|[COle 控制：启用简单帧](#enablesimpleframe)|支持控件的简单帧支持。|
|[COleControl：：交换范围](#exchangeextent)|序列化控件的宽度和高度。|
|[COleControl：：交易所股票供应商](#exchangestockprops)|序列化控件的库存属性。|
|[COleControl：交换版本](#exchangeversion)|序列化控件的版本号。|
|[COle 控制：火击](#fireclick)|触发库存`Click`事件。|
|[COleControl：：火点点击](#firedblclick)|触发库存`DblClick`事件。|
|[COle控制：火错误](#fireerror)|触发库存`Error`事件。|
|[COle 控制：火事件](#fireevent)|触发自定义事件。|
|[COle 控制：：火键向下](#firekeydown)|触发库存`KeyDown`事件。|
|[COleControl：：FireKeyPress](#firekeypress)|触发库存`KeyPress`事件。|
|[COle 控制：火键向上](#firekeyup)|触发库存`KeyUp`事件。|
|[COleControl：火鼠向下](#firemousedown)|触发库存`MouseDown`事件。|
|[COleControl：火鼠移动](#firemousemove)|触发库存`MouseMove`事件。|
|[COleControl：火鼠](#firemouseup)|触发库存`MouseUp`事件。|
|[COle 控制：：火就绪状态更改](#firereadystatechange)|当控件的就绪状态发生更改时，触发事件。|
|[COleControl：获取激活策略](#getactivationpolicy)|更改支持接口的控件的`IPointerInactive`默认激活行为。|
|[COleControl：获取环境属性](#getambientproperty)|返回指定环境属性的值。|
|[COleControl：获取外观](#getappearance)|返回股票外观属性的值。|
|[COleControl：获取回归颜色](#getbackcolor)|返回股票 BackColor 属性的值。|
|[COle 控制：获取边框样式](#getborderstyle)|返回股票 BorderStyle 属性的值。|
|[COle 控制：获取捕获](#getcapture)|确定无窗口、激活的控件对象是否具有鼠标捕获。|
|[COle 控制：获取类 ID](#getclassid)|检索控件的 OLE 类 ID。|
|[COle 控制：获取客户端偏移](#getclientoffset)|检索控件矩形区域的左上角与其工作区的左上角之间的差异。|
|[COleControl：获取客户端](#getclientrect)|检索控件工作区的大小。|
|[COleControl：获取客户网站](#getclientsite)|查询指向其容器中当前客户端站点的指针的对象。|
|[COle 控制：获取控制标志](#getcontrolflags)|检索控件标志设置。|
|[COle 控制：获取控制大小](#getcontrolsize)|返回 OLE 控件的位置和大小。|
|[COle 控制：GetDC](#getdc)|提供一种无窗口控件从其容器获取设备上下文的方法。|
|[COle 控制：启用](#getenabled)|返回股票启用属性的值。|
|[COle 控制：获取扩展控制](#getextendedcontrol)|检索指向属于容器的扩展控件对象的指针。|
|[COleControl：获取焦点](#getfocus)|确定控件是否具有焦点。|
|[COleControl：获取字体](#getfont)|返回股票字体属性的值。|
|[COleControl：获取字体文本指标](#getfonttextmetrics)|返回`CFontHolder`对象的指标。|
|[COleControl：获取福彩](#getforecolor)|返回股票 ForeColor 属性的值。|
|[COleControl：GetHwnd](#gethwnd)|返回股票 hWnd 属性的值。|
|[COle 控制：获取消息字符串](#getmessagestring)|提供菜单项的状态栏文本。|
|[COle 控制：不受支持](#getnotsupported)|防止用户访问控件的属性值。|
|[COleControl：准备状态](#getreadystate)|返回控件的就绪状态。|
|[COle 控制：获取 rectin 容器](#getrectincontainer)|返回控件相对于其容器的矩形。|
|[COleControl：获取股票文本指标](#getstocktextmetrics)|返回股票字体属性的指标。|
|[COleControl：获取文本](#gettext)|返回股票文本或标题属性的值。|
|[COle 控制：获取无窗口丢弃目标](#getwindowlessdroptarget)|覆盖以允许无窗口控件成为拖放操作的目标。|
|[COle 控制：初始化 IID](#initializeiids)|通知控件将使用的 IID 的基类。|
|[COleControl：内部获取字体](#internalgetfont)|返回股票`CFontHolder`字体属性的对象。|
|[COleControl：内部获取文本](#internalgettext)|检索库存标题或文本属性。|
|[COleControl：：内部就绪状态](#internalsetreadystate)|设置控件的就绪状态并触发就绪状态更改事件。|
|[COle 控制：无效控制](#invalidatecontrol)|使显示的控件的区域无效，从而导致重新绘制该控件。|
|[COleControl：无效](#invalidatergn)|使给定区域内的容器窗口的工作区无效。 可用于重绘区域中的无窗口控件。|
|[COleControl：正在转换VBX](#isconvertingvbx)|允许专门加载 OLE 控件。|
|[COle 控制：已修改](#ismodified)|确定控件状态是否已更改。|
|[COleControl：优化绘制](#isoptimizeddraw)|指示容器是否支持当前绘图操作的优化绘图。|
|[COle 控制：是子类控制](#issubclassedcontrol)|调用 以确定控件是否对 Windows 控件进行子类。|
|[COle 控制：加载](#load)|重置任何以前的异步数据，并启动控件的异步属性的新负载。|
|[COle 控制：锁定位置活动](#lockinplaceactive)|确定控件是否可以由容器停用。|
|[COleControl：关于环境属性更改](#onambientpropertychange)|更改环境属性时调用。|
|[COle 控制：在外观上已更改](#onappearancechanged)|更改股票外观属性时调用。|
|[COle 控制：onbackColor 已更改](#onbackcolorchanged)|更改股票 BackColor 属性时调用。|
|[COle 控制：在边框样式上已更改](#onborderstylechanged)|更改股票边框样式属性时调用。|
|[COleControl：点击](#onclick)|已调用以触发库存单击事件。|
|[COle 控制：关闭](#onclose)|通知已调用的`IOleControl::Close`控件。|
|[COleControl：OnDoVerb](#ondoverb)|执行控制谓词后调用。|
|[COleControl：在画上](#ondraw)|当请求控件重新绘制自身时调用。|
|[COleControl：在画元文件](#ondrawmetafile)|当请求控件使用元文件设备上下文重绘自身时，容器调用该容器。|
|[COleControl：：编辑](#onedit)|容器调用 UI 激活 OLE 控件。|
|[COle 控制：启用](#onenabledchanged)|更改股票启用属性时调用。|
|[COleControl：onEnumVerbs](#onenumverbs)|容器调用以枚举控件的谓词。|
|[COleControl：在事件建议](#oneventadvise)|当事件处理程序连接或与控件断开连接时调用。|
|[COleControl：：放大缩小字体功能 放大缩小字体功能](#onfontchanged)|更改股票字体属性时调用。|
|[COleControl：OnforeColor 已更改](#onforecolorchanged)|更改股票前颜色属性时调用。|
|[COleControl：在冻结事件](#onfreezeevents)|当控件的事件被冻结或解冻时调用。|
|[COleControl：onGetColorSet](#ongetcolorset)|通知已调用的`IOleObject::GetColorSet`控件。|
|[COleControl：OnGetControlInfo](#ongetcontrolinfo)|向容器提供助记符信息。|
|[COle 控制：：在GetDisplayString上](#ongetdisplaystring)|调用以获取表示属性值的字符串。|
|[COleControl：ongetinplacemenu](#ongetinplacemenu)|请求将与容器菜单合并的控件菜单的句柄。|
|[COleControl：OnGet自然范围](#ongetnaturalextent)|覆盖以检索控件的显示大小，最接近建议的大小和范围模式。|
|[COle 控制：：打开预定义字符串](#ongetpredefinedstrings)|返回表示属性的可能值的字符串。|
|[COle 控制：：获取预定义值](#ongetpredefinedvalue)|返回与预定义字符串对应的值。|
|[COleControl：OngetView 范围](#ongetviewextent)|覆盖以检索控件的显示区域的大小（可用于启用双通道绘图）。|
|[COleControl：OngetViewrect](#ongetviewrect)|覆盖以将控件的大小转换为从特定位置开始的矩形。|
|[COleControl：Onget查看状态](#ongetviewstatus)|覆盖以检索控件的视图状态。|
|[COle 控制：在隐藏工具栏上](#onhidetoolbars)|当控件被 UI 停用时，容器调用。|
|[COle 控制：在活动鼠标移动](#oninactivemousemove)|覆盖以将鼠标指针下的非活动控件的容器调度WM_MOUSEMOVE消息发送到该控件。|
|[COle 控制：oninactiveSetCursor](#oninactivesetcursor)|覆盖以将鼠标指针下的非活动控件的容器调度WM_SETCURSOR消息发送到该控件。|
|[COleControl：在键下事件](#onkeydownevent)|在股票密钥关闭事件已触发后调用。|
|[COleControl：：在KeyPress事件](#onkeypressevent)|股票 KeyPress 事件已触发后调用。|
|[COleControl：在KeyUpevent上](#onkeyupevent)|在股票 KeyUp 事件已触发后调用。|
|[COleControl：在地图属性页](#onmappropertytopage)|指示用于编辑属性的属性页。|
|[COleControl：onMnemonic](#onmnemonic)|按下控件的助记符键时调用。|
|[COle 控制：：属性](#onproperties)|调用控件的"属性"谓词时调用。|
|[COle 控制：在查询命中点](#onqueryhitpoint)|覆盖以查询控件的显示是否与给定点重叠。|
|[COleControl：在查询中](#onqueryhitrect)|覆盖以查询控件的显示是否与给定矩形中的任何点重叠。|
|[COle 控制：在渲染数据上](#onrenderdata)|框架调用以检索指定格式的数据。|
|[COle 控制：在渲染文件数据上](#onrenderfiledata)|框架调用以以指定格式从文件检索数据。|
|[COle 控制：在渲染全局数据](#onrenderglobaldata)|框架调用以以指定格式从全局内存检索数据。|
|[COle 控制：在重置状态](#onresetstate)|将控件的属性重置为默认值。|
|[COleControl：在设置客户端站点](#onsetclientsite)|通知已调用的`IOleControl::SetClientSite`控件。|
|[COleControl：OnSetData](#onsetdata)|将控件的数据替换为另一个值。|
|[COle 控制：在设置范围](#onsetextent)|在控件的范围已更改后调用。|
|[COle 控制：OnSetObjectrects](#onsetobjectrects)|更改控件的尺寸后调用。|
|[COleControl：：在显示工具栏上](#onshowtoolbars)|在激活控件时调用。|
|[COle 控制：在文本上更改](#ontextchanged)|更改股票文本或标题属性时调用。|
|[COleControl：无窗口消息](#onwindowlessmessage)|处理无窗口控件的窗口消息（鼠标和键盘消息以外的）。|
|[COleControl：:P客户](#parenttoclient)|将相对于容器原点的点转换为相对于控件原点的点。|
|[COleControl：:P模式对话](#postmodaldialog)|通知容器模式对话框已关闭。|
|[COleControl：:P重新模式对话](#premodaldialog)|通知容器即将显示模式对话框。|
|[COle 控制：：重新创建控制窗口](#recreatecontrolwindow)|销毁并重新创建控件的窗口。|
|[COle 控制：刷新](#refresh)|强制重新绘制控件的外观。|
|[COle 控制：：发布捕获](#releasecapture)|释放鼠标捕获。|
|[COle 控制：释放DC](#releasedc)|释放无窗口控件容器的显示设备上下文。|
|[COle 控制：：重父控制窗口](#reparentcontrolwindow)|重置控件窗口的父级。|
|[COle 控制：：重置库存](#resetstockprops)|将`COleControl`股票属性初始化到其默认值。|
|[COle 控制：重置版本](#resetversion)|将版本号初始化为给定值。|
|[COle 控制：滚动窗口](#scrollwindow)|允许无窗口控件滚动其就地活动图像中的区域。|
|[COle 控制：选择字体对象](#selectfontobject)|在设备上下文中选择自定义字体属性。|
|[COleControl：选择库存字体](#selectstockfont)|在设备上下文中选择"库存字体"属性。|
|[COle 控制：序列化范围](#serializeextent)|序列化或初始化控件的显示空间。|
|[COle 控制：：序列化库存](#serializestockprops)|序列化或初始化`COleControl`股票属性。|
|[COle 控制：序列化版本](#serializeversion)|序列化或初始化控件的版本信息。|
|[COle 控制：：设置外观](#setappearance)|设置股票外观属性的值。|
|[COle 控制：：设置回颜色](#setbackcolor)|设置股票 BackColor 属性的值。|
|[COle 控制：设置边框样式](#setborderstyle)|设置股票边界样式属性的值。|
|[COle 控制：设置捕获](#setcapture)|使控件的容器窗口代表控件获取鼠标捕获。|
|[COle 控制：设置控制大小](#setcontrolsize)|设置 OLE 控件的位置和大小。|
|[COle 控制：已启用](#setenabled)|设置股票启用属性的值。|
|[COle 控制：设置焦点](#setfocus)|使控件的容器窗口以控件的名义占用输入焦点。|
|[COle 控制：：设置字体](#setfont)|设置股票字体属性的值。|
|[COleControl：设置福彩](#setforecolor)|设置股票 ForeColor 属性的值。|
|[COle 控制：设置初始大小](#setinitialsize)|设置首次显示在容器中的 OLE 控件的大小。|
|[COle 控制：设置已修改的标记](#setmodifiedflag)|更改控件的已修改状态。|
|[COle 控制：设置不允许](#setnotpermitted)|指示编辑请求失败。|
|[COle 控制：设置不支持](#setnotsupported)|防止用户修改控件的属性值。|
|[COle 控制：setrectin 容器](#setrectincontainer)|设置控件相对于其容器的矩形。|
|[COle 控制：设置文本](#settext)|设置股票文本或标题属性的值。|
|[COle 控制：：投掷错误](#throwerror)|指示 OLE 控件中发生错误。|
|[COle 控制：转换库德](#transformcoords)|转换容器和控件之间的坐标值。|
|[COleControl：翻译颜色](#translatecolor)|将OLE_COLOR值转换为 COLORREF 值。|
|[COle 控制：在加载期间，环境将有效](#willambientsbevalidduringload)|确定下次加载控件时环境属性是否可用。|
|[COle 控制：：窗口 Proc](#windowproc)|为`COleControl`对象提供 Windows 过程。|

### <a name="protected-methods"></a>受保护的方法

|名称|说明|
|----------|-----------------|
|[COleControl：:D原始内容](#drawcontent)|当需要更新控件的外观时，由框架调用。|
|[COleControl：:D原始元文件](#drawmetafile)|使用元文件设备上下文时由框架调用。|
|[COle 控制：被调用允许](#isinvokeallowed)|启用自动化方法调用。|
|[COleControl：设置初始数据格式](#setinitialdataformats)|由框架调用以初始化控件支持的数据格式列表。|

## <a name="remarks"></a>备注

派生自`CWnd`的类继承 Windows 窗口对象的所有功能以及特定于 OLE 的其他功能，如事件触发和支持方法和属性的功能。

OLE 控件可以插入到 OLE 容器应用程序中，并使用事件触发的双向系统与容器通信，并将方法和属性公开到容器中。 请注意，标准 OLE 容器仅支持 OLE 控件的基本功能。 它们无法支持 OLE 控件的扩展功能。 当由于控件中发生的某些操作而将事件发送到容器时，将发生事件触发。 反过来，容器通过使用与C++类的成员函数和数据成员类似的一组公开方法和属性与控件通信。 此方法允许开发人员控制控件的外观，并在发生某些操作时通知容器。

## <a name="windowless-controls"></a>无窗口控件

OLE 控件可以在没有窗口的情况下就地活动使用。 无窗口控件具有显著优势：

- 无窗口控件可以是透明的和非矩形的

- 无窗口控件可减少对象的实例大小和创建时间

控件不需要窗口。 窗口提供的服务可通过单个共享窗口（通常是容器的窗口）和一些调度代码轻松提供。 拥有窗口在对象上大多是不必要的复杂因素。

使用无窗口激活时，容器（其中确实有一个窗口）负责提供否则由控件自己的窗口提供的服务。 例如，如果控件需要查询键盘焦点、查询鼠标捕获或获取设备上下文，则这些操作由容器管理。 无`COleControl`窗口操作成员函数在容器上调用这些操作。

启用无窗口激活后，容器会将输入消息委托给控件的`IOleInPlaceObjectWindowless`接口（用于无窗口支持的[IOleInPlace 对象的](/windows/win32/api/oleidl/nn-oleidl-ioleinplaceobject)扩展）。 `COleControl`此接口的实现将在适当调整鼠标坐标后通过控件的消息映射调度这些消息。 通过将相应的条目添加到消息映射，可以像普通窗口消息一样处理这些消息。

在无窗口控件中`COleControl`，应始终使用成员函数，而不是相应的`CWnd`成员函数或其相关的 Windows API 函数。

OLE 控制对象也可以创建窗口，只有当它们变为活动状态时，但非活动-主动过渡所需的工作量会上升，转换的速度也会降低。 在某些情况下，这是一个问题：例如，考虑文本框的网格。 在列上下游标时，每个控件都必须就地激活，然后停用。 非活动/主动过渡的速度将直接影响滚动速度。

有关开发 OLE 控制框架的详细信息，请参阅[文章 MFC ActiveX](../../mfc/mfc-activex-controls.md)控制和[概述：创建 MFC ActiveX 控制程序](../../mfc/reference/mfc-activex-control-wizard.md)。 有关优化 OLE 控件（包括无窗口和无闪烁控件）的信息，请参阅[MFC ActiveX 控件：优化](../../mfc/mfc-activex-controls-optimization.md)。

## <a name="inheritance-hierarchy"></a>继承层次结构

[CObject](../../mfc/reference/cobject-class.md)

[CCmdTarget](../../mfc/reference/ccmdtarget-class.md)

[CWnd](../../mfc/reference/cwnd-class.md)

`COleControl`

## <a name="requirements"></a>要求

**标题：** afxctl.h

## <a name="colecontrolambientbackcolor"></a><a name="ambientbackcolor"></a>COle 控制：环境背面颜色

返回环境 BackColor 属性的值。

```
OLE_COLOR AmbientBackColor();
```

### <a name="return-value"></a>返回值

容器的环境 BackColor 属性（如果有）的当前值。 如果不支持该属性，则此函数将返回系统定义的 Windows 背景颜色。

### <a name="remarks"></a>备注

环境 BackColor 属性可用于所有控件，由容器定义。 请注意，不支持此属性不需要该容器。

## <a name="colecontrolambientdisplayname"></a><a name="ambientdisplayname"></a>COleControl：环境显示名称

容器分配给控件的名称可用于向用户显示的错误消息。

```
CString AmbientDisplayName();
```

### <a name="return-value"></a>返回值

OLE 控件的名称。 默认值为零长度字符串。

### <a name="remarks"></a>备注

请注意，不支持此属性不需要该容器。

## <a name="colecontrolambientfont"></a><a name="ambientfont"></a>COleControl：环境字体

返回环境字体属性的值。

```
LPFONTDISP AmbientFont();
```

### <a name="return-value"></a>返回值

指向容器的环境字体调度界面的指针。 默认值为 NULL。 如果返回不等于 NULL，则负责通过调用其[INotnot：：：释放](/windows/win32/api/unknwn/nf-unknwn-iunknown-release)成员功能来释放字体。

### <a name="remarks"></a>备注

环境字体属性由容器定义，可供所有控件使用。请注意，不支持此属性不需要该容器。

## <a name="colecontrolambientforecolor"></a><a name="ambientforecolor"></a>COleControl：环境福彩

返回环境 ForeColor 属性的值。

```
OLE_COLOR AmbientForeColor();
```

### <a name="return-value"></a>返回值

容器的环境 ForeColor 属性（如果有）的当前值。 如果不支持，此函数将返回系统定义的 Windows 文本颜色。

### <a name="remarks"></a>备注

环境 ForeColor 属性可用于所有控件，由容器定义。 请注意，不支持此属性不需要该容器。

## <a name="colecontrolambientlocaleid"></a><a name="ambientlocaleid"></a>COleControl：环境区域ID

返回容器的区域设置 ID。

```
LCID AmbientLocaleID();
```

### <a name="return-value"></a>返回值

容器的 LocaleID 属性的值（如果有）。 如果不支持此属性，则此函数返回 0。

### <a name="remarks"></a>备注

控件可以使用区域设置ID调整其用户界面以进行特定区域设置。 请注意，不支持此属性不需要该容器。

## <a name="colecontrolambientappearance"></a><a name="ambientappearance"></a>COleControl：环境外观

检索控件对象的当前外观设置。

```
short AmbientAppearance();
```

### <a name="return-value"></a>返回值

控件的外观：

- **0**平面外观

- **1** 3D 外观

### <a name="remarks"></a>备注

调用此函数以检索控件的DISPID_AMBIENT_APPEARANCE属性的当前值。

## <a name="colecontrolambientscaleunits"></a><a name="ambientscaleunits"></a>COle 控制：：环境尺度单位

返回容器使用的单位类型。

```
CString AmbientScaleUnits();
```

### <a name="return-value"></a>返回值

包含容器的环境缩放单位的字符串。 如果不支持此属性，则此函数返回一个零长度字符串。

### <a name="remarks"></a>备注

容器的环境 ScaleUnits 属性可用于显示位置或尺寸，这些位置或尺寸标有所选单位，如 twips 或厘米。 请注意，不支持此属性不需要该容器。

## <a name="colecontrolambientshowgrabhandles"></a><a name="ambientshowgrabhandles"></a>COle 控制：：环境显示抓手

确定容器是否允许控件在激活时显示自身的抓取控点。

```
BOOL AmbientShowGrabHandles();
```

### <a name="return-value"></a>返回值

如果应显示抓取手柄，则非零;否则 0。 如果不支持此属性，则此函数返回非零。

### <a name="remarks"></a>备注

请注意，不支持此属性不需要该容器。

## <a name="colecontrolambientshowhatching"></a><a name="ambientshowhatching"></a>COle 控制：环境显示填充

确定容器是否允许控件在 UI 处于活动状态时使用阴影模式显示自身。

```
BOOL AmbientShowHatching();
```

### <a name="return-value"></a>返回值

如果应显示阴影图案，则非零;否则 0。 如果不支持此属性，则此函数返回非零。

### <a name="remarks"></a>备注

请注意，不支持此属性不需要该容器。

## <a name="colecontrolambienttextalign"></a><a name="ambienttextalign"></a>COle 控制：环境文本对齐

确定控件容器首选的环境文本对齐方式。

```
short AmbientTextAlign();
```

### <a name="return-value"></a>返回值

容器的环境文本对齐属性的状态。 如果不支持此属性，则此函数返回 0。

以下是有效返回值的列表：

|返回值|含义|
|------------------|-------------|
|0|一般对齐（右侧的数字，左侧的文本）。|
|1|左对齐|
|2|中心|
|3|正确证明|

### <a name="remarks"></a>备注

此属性可用于所有嵌入的控件，并由容器定义。 请注意，不支持此属性不需要该容器。

## <a name="colecontrolambientuidead"></a><a name="ambientuidead"></a>COleControl：环境UIDead

确定容器是否希望控件响应用户界面操作。

```
BOOL AmbientUIDead();
```

### <a name="return-value"></a>返回值

如果控件应响应用户界面操作，则非零;否则 0。 如果不支持此属性，则此函数返回 0。

### <a name="remarks"></a>备注

例如，容器可能在设计模式下将 TRUE 设置为 TRUE。

## <a name="colecontrolambientusermode"></a><a name="ambientusermode"></a>COle 控制：环境用户模式

确定容器是处于设计模式还是用户模式。

```
BOOL AmbientUserMode();
```

### <a name="return-value"></a>返回值

如果容器处于用户模式，则非零;否则 0（在设计模式下）。 如果不支持此属性，则此函数将返回 TRUE。

### <a name="remarks"></a>备注

例如，容器可能会在设计模式下将此设置为 FALSE。

## <a name="colecontrolboundpropertychanged"></a><a name="boundpropertychanged"></a>COle 控制：绑定属性已更改

表示绑定属性值已更改。

```cpp
void BoundPropertyChanged(DISPID dispid);
```

### <a name="parameters"></a>参数

*不一部分*<br/>
控件的绑定属性的调度 ID。

### <a name="remarks"></a>备注

每次属性的值发生更改时，都必须调用此值，即使在未通过属性 Set 方法进行更改的情况下也是如此。 特别要注意映射到成员变量的绑定属性。 任何时候，必须调用此类成员变量`BoundPropertyChanged`。

## <a name="colecontrolboundpropertyrequestedit"></a><a name="boundpropertyrequestedit"></a>COle 控制：：绑定属性请求编辑

请求`IPropertyNotifySink`接口的权限以更改控件提供的绑定属性值。

```
BOOL BoundPropertyRequestEdit(DISPID dispid);
```

### <a name="parameters"></a>参数

*不一部分*<br/>
控件的绑定属性的调度 ID。

### <a name="return-value"></a>返回值

如果允许更改，则非零;否则 0。 默认值为非零。

### <a name="remarks"></a>备注

如果权限被拒绝，控件不得让属性的值更改。 这可以通过忽略或失败试图更改属性值的操作来实现。

## <a name="colecontrolclienttoparent"></a><a name="clienttoparent"></a>COle 控制：：客户端到父级

将*pPoint*的坐标转换为父坐标。

```
virtual void ClientToParent(
    LPCRECT lprcBounds,
    LPPOINT pPoint) const;
```

### <a name="parameters"></a>参数

*lprcBounds*<br/>
指向容器内 OLE 控件的边界。 不是工作区，而是整个控件的区域，包括边框和滚动条。

*pPoint*<br/>
指向 OLE 工作区点的指针要转换为父（容器）的坐标。

### <a name="remarks"></a>备注

在输入*pPoint*上与 OLE 控件的工作区的原点（控件的工作区的左上角）相关。 在输出*pPoint*上相对于父级（容器的左上角）的原点。

## <a name="colecontrolclipcaretrect"></a><a name="clipcaretrect"></a>COle 控制：：ClipCaretrect

如果倾斜矩形完全或部分被重叠的不透明对象覆盖，则调整其矩形。

```
BOOL ClipCaretRect(LPRECT lpRect);
```

### <a name="parameters"></a>参数

*lpRect*<br/>
在输入时，指向[RECT](/windows/win32/api/windef/ns-windef-rect)结构的指针，其中包含要调整的插入区域。 在输出时，如果已完全覆盖的倾斜矩形，则调整的护理区域或 NULL。

### <a name="return-value"></a>返回值

如果成功，则不为 0；否则为 0。

### <a name="remarks"></a>备注

插入器是闪烁的线、块或位图，通常指示文本或图形的插入位置。

如果不首先检查隐器是否部分隐藏或完全被重叠对象隐藏，则无窗口对象无法安全地显示隐匿。 为了使这一点成为可能，对象可以使用`ClipCaretRect`来调整（减少）贴图，以确保其适合剪切区域。

创建 care 器的对象应将加斯特矩形提交`ClipCaretRect`到 caret 并使用调整的矩形进行 caret。 如果 care 完全隐藏，则此方法将返回 FALSE，在这种情况下根本不应显示该 care。

## <a name="colecontrolcolecontrol"></a><a name="colecontrol"></a>COle 控制：COle 控制

构造 `COleControl` 对象。

```
COleControl();
```

### <a name="remarks"></a>备注

通常不直接调用此功能。 相反，OLE 控件通常由其类工厂创建。

## <a name="colecontrolcontrolinfochanged"></a><a name="controlinfochanged"></a>COle 控制：：控制信息已更改

当控件支持的助记符集已更改时，调用此功能。

```cpp
void ControlInfoChanged();
```

### <a name="remarks"></a>备注

收到此通知后，控件的容器通过调用 IOleControl 获得一组新的助记符[：：getControlInfo](/windows/win32/api/ocidl/nf-ocidl-iolecontrol-getcontrolinfo)。 请注意，不需要容器响应此通知。

## <a name="colecontroldisplayerror"></a><a name="displayerror"></a>COleControl：:D播放错误

处理股票错误事件后由框架调用（除非事件处理程序已禁止显示错误）。

```
virtual void DisplayError(
    SCODE scode,
    LPCTSTR lpszDescription,
    LPCTSTR lpszSource,
    LPCTSTR lpszHelpFile,
    UINT nHelpID);
```

### <a name="parameters"></a>参数

*scode*<br/>
要报告的状态代码值。 有关可能代码的完整列表，请参阅["ActiveX 控件：高级主题"一](../../mfc/mfc-activex-controls-advanced-topics.md)文。

*lpsz描述*<br/>
报告的错误的说明。

*lpsz来源*<br/>
生成错误的模块的名称（通常为 OLE 控制模块的名称）。

*lpszHelp文件*<br/>
包含错误说明的帮助文件的名称。

*nHelpID*<br/>
报告错误的帮助上下文 ID。

### <a name="remarks"></a>备注

默认行为显示一个消息框，其中包含错误描述，包含在*lpsz描述 中*。

重写此函数以自定义错误显示方式。

## <a name="colecontroldoclick"></a><a name="doclick"></a>COleControl：:DoClick

模拟控件上的鼠标单击操作。

```cpp
void DoClick();
```

### <a name="remarks"></a>备注

将调用可`COleControl::OnClick`重写的成员函数，如果控件支持，将触发库存单击事件。

`COleControl`基类支持此功能作为股票方法（称为 DoClick）。 有关详细信息，请参阅文章[ActiveX 控件：方法](../../mfc/mfc-activex-controls-methods.md)。

## <a name="colecontroldopropexchange"></a><a name="dopropexchange"></a>COleControl：:DoPropExchange

从持久存储表示（如流或属性集）加载或存储控件时由框架调用。

```
virtual void DoPropExchange(CPropExchange* pPX);
```

### <a name="parameters"></a>参数

*pPX*<br/>
一个指向 `CPropExchange` 对象的指针。 框架提供此对象以建立属换的上下文，包括其方向。

### <a name="remarks"></a>备注

此函数通常调用**PX_** 函数系列以加载或存储 OLE 控件的特定用户定义属性。

如果控件向导已用于创建 OLE 控制项目，则此函数的重写版本将序列化基类函数 调用 支持`COleControl`的股票属性`COleControl::DoPropExchange`。 将用户定义的属性添加到 OLE 控件时，需要修改此函数以序列化新属性。 有关序列化的详细信息，请参阅[ActiveX 控件：序列化](../../mfc/mfc-activex-controls-serializing.md)。

## <a name="colecontroldosuperclasspaint"></a><a name="dosuperclasspaint"></a>COleControl：:D超类绘画

重绘从 Windows 控件中子分类的 OLE 控件。

```cpp
void DoSuperclassPaint(
    CDC* pDC,
    const CRect& rcBounds);
```

### <a name="parameters"></a>参数

*pDC*<br/>
指向控件容器的设备上下文的指针。

*rcBunds*<br/>
要绘制控件的区域。

### <a name="remarks"></a>备注

调用此函数以正确处理非活动 OLE 控件的绘制。 仅当 OLE 控件子类 Windows 控件时才应使用此函数，`OnDraw`并且应在控件的函数中调用。

有关此功能和子类 Windows 控件的详细信息，请参阅["ActiveX 控件：对 Windows 控件进行子类化](../../mfc/mfc-activex-controls-subclassing-a-windows-control.md)"一文。

## <a name="colecontroldrawcontent"></a><a name="drawcontent"></a>COleControl：:D原始内容

当需要更新控件的外观时，由框架调用。

```cpp
void DrawContent(
    CDC* pDC,
    CRect& rc);
```

### <a name="parameters"></a>参数

*pDC*<br/>
指向设备上下文的指针。

*钢筋混凝土*<br/>
要绘制的矩形区域。

### <a name="remarks"></a>备注

此函数直接调用可`OnDraw`重写函数。

## <a name="colecontroldrawmetafile"></a><a name="drawmetafile"></a>COleControl：:D原始元文件

使用元文件设备上下文时由框架调用。

```cpp
void DrawMetafile(
    CDC* pDC,
    CRect& rc);
```

### <a name="parameters"></a>参数

*pDC*<br/>
指向元文件设备上下文的指针。

*钢筋混凝土*<br/>
要绘制的矩形区域。

## <a name="colecontrolenablesimpleframe"></a><a name="enablesimpleframe"></a>COle 控制：启用简单帧

启用 OLE 控件的简单帧特性。

```cpp
void EnableSimpleFrame();
```

### <a name="remarks"></a>备注

此特性允许控件支持其他控件的可视包含，但不支持真正的 OLE 遏制。 例如，一个组框，其中有多个控件。 这些控件不是 OLE 包含的，但它们位于同一组框中。

## <a name="colecontrolexchangeextent"></a><a name="exchangeextent"></a>COleControl：：交换范围

序列化或初始化控件范围的状态（其尺寸以 HIMETRIC 单位为单位）。

```
BOOL ExchangeExtent(CPropExchange* pPX);
```

### <a name="parameters"></a>参数

*pPX*<br/>
指向[CPropExchange](../../mfc/reference/cpropexchange-class.md)对象的指针。 框架提供此对象以建立属换的上下文，包括其方向。

### <a name="return-value"></a>返回值

如果函数成功，则非零;0 否则。

### <a name="remarks"></a>备注

此函数通常由`COleControl::DoPropExchange`的默认实现调用。

## <a name="colecontrolexchangestockprops"></a><a name="exchangestockprops"></a>COleControl：：交易所股票供应商

序列化或初始化控件的库存属性的状态。

```cpp
void ExchangeStockProps(CPropExchange* pPX);
```

### <a name="parameters"></a>参数

*pPX*<br/>
指向[CPropExchange](../../mfc/reference/cpropexchange-class.md)对象的指针。 框架提供此对象以建立属换的上下文，包括其方向。

### <a name="remarks"></a>备注

此函数通常由`COleControl::DoPropExchange`的默认实现调用。

## <a name="colecontrolexchangeversion"></a><a name="exchangeversion"></a>COleControl：交换版本

序列化或初始化控件的版本信息的状态。

```
BOOL ExchangeVersion(
    CPropExchange* pPX,
    DWORD dwVersionDefault,
    BOOL bConvert = TRUE);
```

### <a name="parameters"></a>参数

*pPX*<br/>
一个指向 `CPropExchange` 对象的指针。 框架提供此对象以建立属换的上下文，包括其方向。

*dwVersionDefault*<br/>
控件的当前版本号。

*b转换*<br/>
指示在保存时是否应将持久性数据转换为最新格式，还是以加载的相同格式进行维护。

### <a name="return-value"></a>返回值

函数的非零成功;0 否则。

### <a name="remarks"></a>备注

通常，这将是控件对 调用 的第一个函数`COleControl::DoPropExchange`。 加载时，此函数读取持久数据的版本号，并相应地设置[CPropExchange](../../mfc/reference/cpropexchange-class.md)对象的版本属性。 保存时，此函数写入持久数据的版本号。

有关持久性和版本控制的详细信息，请参阅[ActiveX 控件：序列化](../../mfc/mfc-activex-controls-serializing.md)。

## <a name="colecontrolfireclick"></a><a name="fireclick"></a>COle 控制：火击

当鼠标单击活动控件时，由框架调用。

```cpp
void FireClick();
```

### <a name="remarks"></a>备注

如果此事件定义为自定义事件，则确定何时触发该事件。

要自动触发"单击"事件，控件的事件映射必须定义库存单击事件。

## <a name="colecontrolfiredblclick"></a><a name="firedblclick"></a>COleControl：：火点点击

当鼠标在活动控件上双击时，由框架调用。

```cpp
void FireDblClick();
```

### <a name="remarks"></a>备注

如果此事件定义为自定义事件，则确定何时触发该事件。

要自动触发 DblClick 事件，控件的事件映射必须定义库存 DblClick 事件。

## <a name="colecontrolfireerror"></a><a name="fireerror"></a>COle控制：火错误

触发库存错误事件。

```cpp
void FireError(
    SCODE scode,
    LPCTSTR lpszDescription,
    UINT nHelpID = 0);
```

### <a name="parameters"></a>参数

*scode*<br/>
要报告的状态代码值。 有关可能代码的完整列表，请参阅["ActiveX 控件：高级主题"一](../../mfc/mfc-activex-controls-advanced-topics.md)文。

*lpsz描述*<br/>
报告的错误的说明。

*nHelpID*<br/>
报告错误的帮助 ID。

### <a name="remarks"></a>备注

此事件提供了一种在代码中适当位置发出错误信号的方式。 与其他股票事件（如单击或鼠标移动）不同，框架永远不会触发错误。

要报告在属性获取函数、属性集函数或自动化方法期间发生的错误，请调用[COleControl：：：throwError](#throwerror)。

OLE 控件的"库存错误"事件的实现使用 SCODE 值。 如果您的控件使用此事件，并且打算在 Visual Basic 4.0 中使用，您将收到错误，因为 Visual Basic 中不支持 SCODE 值。

要解决此问题，请手动更改控件 中的 SCODE 参数。ODL 文件长 **。** 此外，使用 SCODE 参数的任何自定义事件、方法或属性也会导致同样的问题。

## <a name="colecontrolfireevent"></a><a name="fireevent"></a>COle 控制：火事件

使用任意数量的可选参数从控件触发用户定义的事件。

```cpp
void AFX_CDECL FireEvent(
    DISPID dispid,
    BYTE* pbParams,
...);
```

### <a name="parameters"></a>参数

*不一部分*<br/>
要触发的事件的调度 ID。

*pbParams*<br/>
事件参数类型的描述符。

### <a name="remarks"></a>备注

通常不应直接调用此函数。 相反，您将在控件类声明的事件映射部分调用事件触发函数。

*pbParams*参数是**空间**分隔VTS_列表。 其中一个或多个值（由空格（而不是逗号）分隔）指定函数的参数列表。 可能的值如下所示：

|符号|参数类型|
|------------|--------------------|
|VTS_COLOR|OLE_COLOR|
|VTS_FONT|`IFontDisp*`|
|VTS_HANDLE|HWND|
|VTS_PICTURE|`IPictureDisp*`|
|VTS_OPTEXCLUSIVE|OLE_OPTEXCLUSIVE*|
|VTS_TRISTATE|OLE_TRISTATE|
|VTS_XPOS_HIMETRIC|OLE_XPOS_HIMETRIC|
|VTS_YPOS_HIMETRIC|OLE_YPOS_HIMETRIC|
|VTS_XPOS_PIXELS|OLE_XPOS_PIXELS|
|VTS_YPOS_PIXELS|OLE_YPOS_PIXELS|
|VTS_XSIZE_PIXELS|OLE_XSIZE_PIXELS|
|VTS_YSIZE_PIXELS|OLE_XSIZE_PIXELS|
|VTS_XSIZE_HIMETRIC|OLE_XSIZE_HIMETRIC|
|VTS_YSIZE_HIMETRIC|OLE_XSIZE_HIMETRIC|

> [!NOTE]
> 已为所有变体类型定义了其他变体常量，但提供指向变体数据常量的VTS_FONT和VTS_PICTURE除外。 这些常量使用**VTS_P**`constantname`约定命名。 例如，VTS_PCOLOR是指向VTS_COLOR常量的指针。

## <a name="colecontrolfirekeydown"></a><a name="firekeydown"></a>COle 控制：：火键向下

当控件处于活动状态时按下键时，由框架调用。

```cpp
void FireKeyDown(
    USHORT* pnChar,
    short nShiftState);
```

### <a name="parameters"></a>参数

*pnChar*<br/>
指向按下密钥的虚拟密钥代码值。 有关标准虚拟密钥代码的列表，请参阅 Winuser.h

*nShiftState*<br/>
包含以下标志的组合：

- SHIFT_MASK在操作过程中按下 SHIFT 键。

- CTRL_MASK在操作期间按下了 CTRL 键。

- ALT_MASK在操作过程中按下 ALT 键。

### <a name="remarks"></a>备注

如果此事件定义为自定义事件，则确定何时触发该事件。

要自动触发 KeyDown 事件，控件的事件映射必须定义库存 KeyDown 事件。

## <a name="colecontrolfirekeypress"></a><a name="firekeypress"></a>COleControl：：FireKeyPress

当自定义控件在容器中为 UI 活动时，框架调用该键并释放该键。

```cpp
void FireKeyPress(USHORT* pnChar);
```

### <a name="parameters"></a>参数

*pnChar*<br/>
指向按下的键的字符值的指针。

### <a name="remarks"></a>备注

如果此事件定义为自定义事件，则确定何时触发该事件。

事件的接收者可以修改*pnChar，* 例如，将所有小写字符转换为大写。 如果要检查修改后的字符，将重写`OnKeyPressEvent`。

要自动触发 KeyPress 事件，控件的事件映射必须定义库存 KeyPress 事件。

## <a name="colecontrolfirekeyup"></a><a name="firekeyup"></a>COle 控制：火键向上

当自定义控件在容器中为 UI 活动时释放密钥时，由框架调用。

```cpp
void FireKeyUp(
    USHORT* pnChar,
    short nShiftState);
```

### <a name="parameters"></a>参数

*pnChar*<br/>
指向已释放密钥的虚拟密钥代码值。 有关标准虚拟密钥代码的列表，请参阅 Winuser.h

*nShiftState*<br/>
包含以下标志的组合：

- SHIFT_MASK在操作过程中按下 SHIFT 键。

- CTRL_MASK在操作期间按下了 CTRL 键。

- ALT_MASK在操作过程中按下 ALT 键。

### <a name="remarks"></a>备注

如果此事件定义为自定义事件，则确定何时触发该事件。

要自动触发 KeyUp 事件，控件的事件映射必须定义库存 KeyUp 事件。

## <a name="colecontrolfiremousedown"></a><a name="firemousedown"></a>COleControl：火鼠向下

当鼠标按钮按在活动自定义控件上时，由框架调用。

```cpp
void FireMouseDown(
    short nButton,
    short nShiftState,
    OLE_XPOS_PIXELS x,
    OLE_YPOS_PIXELS y);
```

### <a name="parameters"></a>参数

*nButton*<br/>
按下鼠标按钮的数值。 它可以包含以下值之一：

- LEFT_BUTTON鼠标左键按下。

- MIDDLE_BUTTON按下鼠标中间键。

- RIGHT_BUTTON按下鼠标右键。

*nShiftState*<br/>
包含以下标志的组合：

- SHIFT_MASK在操作过程中按下 SHIFT 键。

- CTRL_MASK在操作期间按下了 CTRL 键。

- ALT_MASK在操作过程中按下 ALT 键。

*x*<br/>
按下鼠标按钮时光标的 x 坐标。 坐标相对于控制窗口的左上角。

*Y*<br/>
按下鼠标按钮时光标的 y 坐标。 坐标相对于控制窗口的左上角。

### <a name="remarks"></a>备注

如果此事件定义为自定义事件，则确定何时触发该事件。

要自动触发鼠标下部事件，控件的事件映射必须定义库存鼠标向下事件。

## <a name="colecontrolfiremousemove"></a><a name="firemousemove"></a>COleControl：火鼠移动

当游标移动到活动自定义控件时，由框架调用。

```cpp
void FireMouseMove(
    short nButton,
    short nShiftState,
    OLE_XPOS_PIXELS x,
    OLE_YPOS_PIXELS y);
```

### <a name="parameters"></a>参数

*nButton*<br/>
按下的鼠标按钮的数值。 包含以下值的组合：

- LEFT_BUTTON操作期间按下鼠标左键。

- MIDDLE_BUTTON操作期间按下鼠标中间按钮。

- RIGHT_BUTTON操作期间按下了鼠标右键。

*nShiftState*<br/>
包含以下标志的组合：

- SHIFT_MASK在操作过程中按下 SHIFT 键。

- CTRL_MASK在操作期间按下了 CTRL 键。

- ALT_MASK在操作过程中按下 ALT 键。

*x*<br/>
光标的 x 坐标。 坐标相对于控制窗口的左上角。

*Y*<br/>
光标的 y 坐标。 坐标相对于控制窗口的左上角。

### <a name="remarks"></a>备注

如果此事件定义为自定义事件，则确定何时触发该事件。

要自动触发 MouseMove 事件，控件的事件映射必须定义库存 MouseMove 事件。

## <a name="colecontrolfiremouseup"></a><a name="firemouseup"></a>COleControl：火鼠

当鼠标按钮释放到活动自定义控件上时，由框架调用。

```cpp
void FireMouseUp(
    short nButton,
    short nShiftState,
    OLE_XPOS_PIXELS x,
    OLE_YPOS_PIXELS y);
```

### <a name="parameters"></a>参数

*nButton*<br/>
释放的鼠标按钮的数值。 可以具有以下一个值：

- LEFT_BUTTON鼠标左键已释放。

- MIDDLE_BUTTON鼠标中间键已释放。

- RIGHT_BUTTON鼠标右键已释放。

*nShiftState*<br/>
包含以下标志的组合：

- SHIFT_MASK在操作过程中按下 SHIFT 键。

- CTRL_MASK在操作期间按下了 CTRL 键。

- ALT_MASK在操作过程中按下 ALT 键。

*x*<br/>
释放鼠标按钮时光标的 x 坐标。 坐标相对于控制窗口的左上角。

*Y*<br/>
释放鼠标按钮时光标的 y 坐标。 坐标相对于控制窗口的左上角。

### <a name="remarks"></a>备注

如果此事件定义为自定义事件，则确定何时触发该事件。

要自动触发 MouseUp 事件，控件的事件映射必须定义库存 MouseUp 事件。

## <a name="colecontrolfirereadystatechange"></a><a name="firereadystatechange"></a>COle 控制：：火就绪状态更改

使用就绪控制状态的当前值触发事件。

```cpp
void FireReadyStateChange();
```

### <a name="remarks"></a>备注

就绪状态可以是以下值之一：

|||
|-|-|
|READYSTATE_UNINITIALIZED|默认初始化状态|
|READYSTATE_LOADING|控件当前正在加载其属性|
|READYSTATE_LOADED|控件已初始化|
|READYSTATE_INTERACTIVE|控件有足够的数据是交互式的，但并非所有异步数据都已加载|
|READYSTATE_COMPLETE|控件具有所有数据|

使用[GetReadyState](#getreadystate)确定控件的当前就绪状态。

[内部集就绪状态](#internalsetreadystate)将就绪状态更改为提供的值，然后调用`FireReadyStateChange`。

## <a name="colecontrolgetactivationpolicy"></a><a name="getactivationpolicy"></a>COleControl：获取激活策略

更改支持接口的控件的`IPointerInactive`默认激活行为。

```
virtual DWORD GetActivationPolicy();
```

### <a name="return-value"></a>返回值

POINTERINACTIVE 枚举中的标志的组合。 可能的标志包括：

|||
|-|-|
|POINTERINACTIVE_ACTIVATEONENTRY|当鼠标在鼠标移动操作期间进入对象时，对象应就地激活。|
|POINTERINACTIVE_DEACTIVATEONLEAVE|当鼠标在鼠标移动操作期间离开对象时，应停用该对象。|
|POINTERINACTIVE_ACTIVATEONDRAG|在拖放操作期间，当鼠标拖动到对象上时，该对象应就地激活。|

### <a name="remarks"></a>备注

启用`IPointerInactive`接口后，容器将委托WM_SETCURSOR并将消息WM_MOUSEMOVE。 `COleControl`此接口的实现将在适当调整鼠标坐标后通过控件的消息映射调度这些消息。

每当容器收到带有鼠标指针的WM_SETCURSOR或WM_MOUSEMOVE消息，该消息位于支持`IPointerInactive`非活动对象上时，它应`GetActivationPolicy`调用接口并从 POINTERINACTIVE 枚举返回标志。

通过将相应的条目添加到消息映射，可以像普通窗口消息一样处理这些消息。 在处理程序中，避免使用`m_hWnd`成员变量（或使用它的任何成员函数），而不首先检查其值是否为非 NULL。

任何旨在执行比设置鼠标光标和/或触发鼠标移动事件（如提供特殊视觉反馈）的目标都应返回POINTERINACTIVE_ACTIVATEONENTRY标志，并且仅在激活时绘制反馈。 如果对象返回此标志，容器应立即就地激活它，然后转发它触发调用`GetActivationPolicy`的相同消息。

如果同时返回POINTERINACTIVE_ACTIVATEONENTRY标志和POINTERINACTIVE_DEACTIVATEONLEAVE标志，则仅当鼠标位于对象上时才会激活该对象。 如果只返回POINTERINACTIVE_ACTIVATEONENTRY标志，则仅在鼠标首次进入对象时激活对象一次。

您可能还希望非活动控件成为 OLE 拖放操作的目标。 这需要在用户将对象拖动到控件时激活控件，以便可以将控件的窗口注册为放置目标。 要在拖动过程中导致激活，请返回POINTERINACTIVE_ACTIVATEONDRAG标志：

[!code-cpp[NVC_MFCAxCtl#1](../../mfc/reference/codesnippet/cpp/colecontrol-class_1.cpp)]

由 来`GetActivationPolicy`传递的信息不应由容器缓存。 相反，每次鼠标进入非活动对象时，都应调用此方法。

如果非活动对象在鼠标进入时未请求就地激活，则只要鼠标指针停留在该对象上，其容器应通过调用[OnInactiveSetCursor](#oninactivesetcursor)向此对象发送后续WM_SETCURSOR消息。

启用接口`IPointerInactive`通常意味着您希望控件能够随时处理鼠标消息。 要在不支持`IPointerInactive`接口的容器中获取此行为，需要在可见时始终激活控件，这意味着控件在其杂项标志中应具有OLEMISC_ACTIVATEWHENVISIBLE标志。 但是，为了防止此标志在支持`IPointerInactive`的容器中生效，还可以指定OLEMISC_IGNOREACTIVATEWHENVISIBLE标志：

[!code-cpp[NVC_MFCAxCtl#10](../../mfc/reference/codesnippet/cpp/colecontrol-class_2.cpp)]

## <a name="colecontrolgetambientproperty"></a><a name="getambientproperty"></a>COleControl：获取环境属性

获取容器的环境属性的值。

```
BOOL GetAmbientProperty(
    DISPID dispid,
    VARTYPE vtProp,
    void* pvProp);
```

### <a name="parameters"></a>参数

*德迪皮德*<br/>
所需环境属性的调度 ID。

*vtProp*<br/>
一种变体类型标记，用于指定要在*pvProp*中返回的值的类型。

*pvProp*<br/>
指向将接收属性值或返回值的变量地址的指针。 此指针的实际类型必须与*vtProp*指定的类型匹配。

|vtProp|pvProp 的类型|
|------------|--------------------|
|VT_BOOL|`BOOL*`|
|VT_BSTR|`CString*`|
|VT_I2|`short*`|
|VT_I4|`long*`|
|VT_R4|`float*`|
|VT_R8|`double*`|
|VT_CY|`CY*`|
|VT_COLOR|`OLE_COLOR*`|
|VT_DISPATCH|`LPDISPATCH*`|
|VT_FONT|`LPFONTDISP*`|

### <a name="return-value"></a>返回值

如果环境属性受支持，则非零;否则 0。

### <a name="remarks"></a>备注

如果用于`GetAmbientProperty`检索环境显示名称和缩放单位属性，则将*vtProp*设置为VT_BSTR，并将*pvProp*设置为`CString*`。 如果要检索环境字体属性，则将*vtProp*设置为VT_FONT，将*pvProp*设置为 LPFONTDISP*。

请注意，已经为常见的环境属性（如[环境返回颜色](#ambientbackcolor)和环境[字体](#ambientfont)）提供了函数。

## <a name="colecontrolgetappearance"></a><a name="getappearance"></a>COleControl：获取外观

实现控件的库存外观属性的 Get 函数。

```
short GetAppearance ();
```

### <a name="return-value"></a>返回值

返回值将当前外观设置指定为**短**（VT_I2）值（如果成功）。 如果控件的外观为平面，则此值为零;如果控件的外观为 3D，则此值为 1。

## <a name="colecontrolgetbackcolor"></a><a name="getbackcolor"></a>COleControl：获取回归颜色

实现控件的库存 BackColor 属性的获取功能。

```
OLE_COLOR GetBackColor();
```

### <a name="return-value"></a>返回值

返回值将当前背景颜色指定为OLE_COLOR值（如果成功）。 此值可以转换为与 调用`TranslateColor`的 COLORREF 值。

## <a name="colecontrolgetborderstyle"></a><a name="getborderstyle"></a>COle 控制：获取边框样式

实现控件的库存 BorderStyle 属性的获取函数。

```
short GetBorderStyle();
```

### <a name="return-value"></a>返回值

如果控件具有正常边框，则为 1;如果控件没有边框，则为 0。

## <a name="colecontrolgetcapture"></a><a name="getcapture"></a>COle 控制：获取捕获

确定`COleControl`对象是否具有鼠标捕获。

```
CWnd* GetCapture();
```

### <a name="return-value"></a>返回值

如果控件已激活且无窗口，则如果控件当前具有鼠标捕获（由控件的容器确定），则返回**该**控件;如果控件没有捕获，则返回 NULL。

否则，返回具有`CWnd`鼠标捕获的对象（与`CWnd::GetCapture`相同）。

### <a name="remarks"></a>备注

调用[SetCapture](#setcapture)时，激活的无窗口控件将接收鼠标捕获。

## <a name="colecontrolgetclassid"></a><a name="getclassid"></a>COle 控制：获取类 ID

由框架调用以检索控件的 OLE 类 ID。

```
virtual HRESULT GetClassID(LPCLSID pclsid) = 0;
```

### <a name="parameters"></a>参数

*pclsid*<br/>
指向类 ID 的位置。

### <a name="return-value"></a>返回值

如果调用不成功，则非零;否则 0。

### <a name="remarks"></a>备注

通常由[IMPLEMENT_OLECREATE_EX](class-factories-and-licensing.md#implement_olecreate_ex)实现。

## <a name="colecontrolgetclientoffset"></a><a name="getclientoffset"></a>COle 控制：获取客户端偏移

检索控件矩形区域的左上角与其工作区的左上角之间的差异。

```
virtual void GetClientOffset(long* pdxOffset, long* pdyOffset) const;
```

### <a name="parameters"></a>参数

*pdx偏移*<br/>
指向 OLE 控件工作区的水平偏移。

*pdy偏移*<br/>
指向 OLE 控件工作区的垂直偏移。

### <a name="remarks"></a>备注

OLE 控件的容器内有一个矩形区域。 控件的工作区是控制区域，不包括边框和滚动条。 检索的偏移`GetClientOffset`量是控件矩形区域的左上角与其工作区的左上角之间的差异。 如果控件具有标准边框和滚动条以外的非客户端元素，请覆盖此成员函数以指定偏移量。

## <a name="colecontrolgetclientrect"></a><a name="getclientrect"></a>COleControl：获取客户端

检索控件工作区的大小。

```
virtual void GetClientRect(LPRECT lpRect) const;
```

### <a name="parameters"></a>参数

*lpRect*<br/>
指向包含无`RECT`窗口控件工作区的维度的结构的指针;即控件的大小减去窗口边框、框架、滚动条等。 *lpRect*参数指示控件的客户端矩形的大小，而不是其位置。

## <a name="colecontrolgetclientsite"></a><a name="getclientsite"></a>COleControl：获取客户网站

查询指向其容器中当前客户端站点的指针的对象。

```
LPOLECLIENTSITE GetClientSite();
```

### <a name="return-value"></a>返回值

指向控件的当前客户端站点的容器中的指针。

### <a name="remarks"></a>备注

返回的指针指向 的`IOleClientSite`实例。 由`IOleClientSite`容器实现的接口是对象对其上下文的视图：它锚定在文档中的位置，在文档中获取其存储、用户界面和其他资源。

## <a name="colecontrolgetcontrolflags"></a><a name="getcontrolflags"></a>COle 控制：获取控制标志

检索控件标志设置。

```
virtual DWORD GetControlFlags();
```

### <a name="return-value"></a>返回值

控件标志枚举中标志的 ORed 组合：

```
enum ControlFlags {
    fastBeginPaint = 0x0001,
    clipPaintDC = 0x0002,
    pointerInactive = 0x0004,
    noFlickerActivate = 0x0008,
    windowlessActivate = 0x0010,
    canOptimizeDraw = 0x0020,
    };
```

### <a name="remarks"></a>备注

默认情况下，`GetControlFlags` 返回 `fastBeginPaint | clipPaintDC`。

|||
|-|-|
|`fastBeginPaint`|如果设置，则使用为 OLE 控件定制的开始绘制函数，而不是[BeginPaint](/windows/win32/api/winuser/nf-winuser-beginpaint) API（默认情况下设置）。|
|`clipPaintDC`|如果未设置，则禁用对`IntersectClipRect`的`COleControl`调用，并获得较小的速度优势。 如果使用无窗口激活，则标志不起作用。|
|`pointerInactive`|如果设置，则通过启用`COleControl`接口的实现（默认情况下禁用该`IPointerInactive`接口）在控件处于非活动状态时提供鼠标交互。|
|`noFlickerActivate`|如果设置，则消除额外的绘图操作和随附的视觉闪烁。 当控件在非活动状态和活动状态下绘制自身时，请使用。 如果使用无窗口激活，则标志不起作用。|
|`windowlessActivate`|如果设置，指示控件使用无窗口激活。|
|`canOptimizeDraw`|如果设置，则指示如果容器支持该控件，则控件将执行优化的绘图。|

有关 OLE`GetControlFlags`控件和其他优化的详细信息，请参阅[ActiveX 控件：优化](../../mfc/mfc-activex-controls-optimization.md)。

## <a name="colecontrolgetcontrolsize"></a><a name="getcontrolsize"></a>COle 控制：获取控制大小

检索 OLE 控制窗口的大小。

```cpp
void GetControlSize(
    int* pcx,
    int* pcy);
```

### <a name="parameters"></a>参数

*pcx*<br/>
指定控件的宽度（以像素为单位）。

*普西*<br/>
指定控件的高度（以像素为单位）。

### <a name="remarks"></a>备注

请注意，控件窗口的所有坐标都相对于控件的左上角。

## <a name="colecontrolgetdc"></a><a name="getdc"></a>COle 控制：GetDC

提供无窗口对象，以便从容器获取屏幕（或兼容）设备上下文。

```
CDC* GetDC(
    LPCRECT lprcRect = NULL,
    DWORD dwFlags = OLEDC_PAINTBKGND);
```

### <a name="parameters"></a>参数

*lprcRect*<br/>
指向无窗口控件要重绘的矩形的指针，位于控件的客户端坐标中。 NULL 表示完整对象的范围。

dwFlags**<br/>
绘制设备上下文的属性。 选项包括：

- OLEDC_NODRAW 指示对象不会使用设备上下文执行任何图形，而只是获取有关显示设备的信息。 容器应简单地通过窗口的DC，而无需进一步处理。

- OLEDC_PAINTBKGND 请求容器在返回 DC 之前绘制背景。 如果对象请求 DC 重新绘制具有透明背景的区域，则应使用此标志。

- OLEDC_OFFSCREEN 通知容器对象希望呈现到屏幕外位图中，然后应复制到屏幕。 当要执行的绘图操作生成大量闪烁时，对象应使用此标志。 容器可以自由地遵守此请求。 但是，如果未设置此标志，容器必须将屏幕上的 DC 交回。 这允许对象执行直接屏幕操作，例如显示选择（通过**XOR**操作）。

### <a name="return-value"></a>返回值

如果成功，指向容器`CWnd`工作区的显示设备上下文;否则，返回值为 NULL。 显示设备上下文可用于后续 GDI 函数，以在容器窗口的工作区中绘制。

### <a name="remarks"></a>备注

必须调用[ReleaseDC](#releasedc)成员函数才能在绘制后释放上下文。 调用`GetDC`时，对象传递他们希望在自己的客户端坐标中绘制的矩形。 `GetDC`将这些转换为容器工作区的坐标。 对象不应请求大于其自身工作区矩形的所需绘图矩形，其大小可以使用[GetClientRect](#getclientrect)检索。 这样可以防止对象无意中绘制不应绘制的位置。

## <a name="colecontrolgetenabled"></a><a name="getenabled"></a>COle 控制：启用

实现控件的"已启用"属性的获取函数。

```
BOOL GetEnabled();
```

### <a name="return-value"></a>返回值

如果启用了控件，则非零;否则 0。

## <a name="colecontrolgetextendedcontrol"></a><a name="getextendedcontrol"></a>COle 控制：获取扩展控制

获取指向由容器维护的对象的指针，该对象表示具有一组扩展属性的控件。

```
LPDISPATCH GetExtendedControl();
```

### <a name="return-value"></a>返回值

指向容器扩展控件对象的指针。 如果没有可用的对象，则值为 NULL。

此对象可以通过其`IDispatch`接口进行操作。 您还可以使用`QueryInterface`来获取对象提供的其他可用接口。 但是，不支持一组特定的接口不需要该对象。 请注意，依赖容器扩展控制对象的特定功能会将控件的可移植性限制为其他任意容器。

### <a name="remarks"></a>备注

调用此函数的函数负责在完成对象后释放指针。 请注意，不支持此对象不需要该容器。

## <a name="colecontrolgetfocus"></a><a name="getfocus"></a>COleControl：获取焦点

确定`COleControl`对象是否具有焦点。

```
CWnd* GetFocus();
```

### <a name="return-value"></a>返回值

如果控件已激活且无窗口，则如果控件当前具有键盘焦点（由控件的容器确定），则返回**该**控件;如果控件没有焦点，则返回 NULL。

否则，返回`CWnd`具有焦点的对象（与`CWnd::GetFocus`相同）。

### <a name="remarks"></a>备注

调用[SetFocus](#setfocus)时，激活的无窗口控件接收焦点。

## <a name="colecontrolgetfont"></a><a name="getfont"></a>COleControl：获取字体

实现股票字体属性的获取函数。

```
LPFONTDISP GetFont();
```

### <a name="return-value"></a>返回值

指向控件的库存字体属性的字体调度界面的指针。

### <a name="remarks"></a>备注

请注意，调用方在完成时必须释放对象。 在控件的实现中，使用`InternalGetFont`访问控件的库存字体对象。 有关在控件中使用字体的详细信息，请参阅[ActiveX 控件：在 ActiveX 控件中使用字体](../../mfc/mfc-activex-controls-using-fonts.md)的文章。

## <a name="colecontrolgetfonttextmetrics"></a><a name="getfonttextmetrics"></a>COleControl：获取字体文本指标

测量控件拥有的任何`CFontHolder`对象的文本指标。

```cpp
void GetFontTextMetrics(
    LPTEXTMETRIC lptm,
    CFontHolder& fontHolder);
```

### <a name="parameters"></a>参数

*lptm*<br/>
指向[TEXTMETRIC](/windows/win32/api/wingdi/ns-wingdi-textmetricw)结构的指针。

*字体持有人*<br/>
对[CFontHolder](../../mfc/reference/cfontholder-class.md)对象的引用。

### <a name="remarks"></a>备注

可以使用[COleControl：：选择字体对象](#selectfontobject)功能选择此类字体。 `GetFontTextMetrics`将初始化`TEXTMETRIC`*lptm*指向的结构，并包含有关`fontHolder`"字体"的有效指标信息（如果成功）;如果成功，则用零填充结构。 在绘制控件时，应使用此函数而不是[GetTextMetrics，](/windows/win32/api/wingdi/nf-wingdi-gettextmetrics)因为控件（与任何嵌入的 OLE 对象）一样，可能需要将自己呈现为元文件。

调用`TEXTMETRIC` [SelectFontObject](#selectfontobject)函数时，将刷新默认字体的结构。 只有在选择股票`GetFontTextMetrics`字体属性后才能调用，以确保其提供的信息有效。

## <a name="colecontrolgetforecolor"></a><a name="getforecolor"></a>COleControl：获取福彩

实现股票前颜色属性的获取函数。

```
OLE_COLOR GetForeColor();
```

### <a name="return-value"></a>返回值

返回值将当前前景颜色指定为OLE_COLOR值（如果成功）。 此值可以转换为与 调用`TranslateColor`的[COLORREF](/windows/win32/gdi/colorref)值。

## <a name="colecontrolgethwnd"></a><a name="gethwnd"></a>COleControl：GetHwnd

实现股票 hWnd 属性的获取函数。

```
OLE_HANDLE GetHwnd();
```

### <a name="return-value"></a>返回值

OLE 控件的窗口句柄（如果有）;否则 NULL。

## <a name="colecontrolgetmessagestring"></a><a name="getmessagestring"></a>COle 控制：获取消息字符串

由框架调用以获取描述*nID*标识的菜单项的用途的短字符串。

```
virtual void GetMessageString(
    UINT nID,
    CString& rMessage) const;
```

### <a name="parameters"></a>参数

*nID*<br/>
菜单项 ID。

*rMessage*<br/>
对[CString](../../atl-mfc-shared/reference/cstringt-class.md)对象的引用，通过该对象将返回字符串。

### <a name="remarks"></a>备注

这可用于获取在突出显示菜单项时在状态栏中显示的消息。 默认实现尝试加载*由 nID*标识的字符串资源。

## <a name="colecontrolgetnotsupported"></a><a name="getnotsupported"></a>COle 控制：不受支持

防止用户访问控件的属性值。

```cpp
void GetNotSupported();
```

### <a name="remarks"></a>备注

调用此函数以代替不支持控件用户检索该属性的任何属性的 Get 函数。 例如，仅写入的属性。

## <a name="colecontrolgetreadystate"></a><a name="getreadystate"></a>COleControl：准备状态

返回控件的就绪状态。

```
long GetReadyState();
```

### <a name="return-value"></a>返回值

控件的就绪状态，以下值之一：

|||
|-|-|
|READYSTATE_UNINITIALIZED|默认初始化状态|
|READYSTATE_LOADING|控件当前正在加载其属性|
|READYSTATE_LOADED|控件已初始化|
|READYSTATE_INTERACTIVE|控件有足够的数据是交互式的，但并非所有异步数据都已加载|
|READYSTATE_COMPLETE|控件具有所有数据|

### <a name="remarks"></a>备注

最简单的控件不需要区分 LOADED 和交互式。 但是，在至少以异步方式接收某些数据之前，支持数据路径属性的控件可能还没有准备好进行交互式访问。 控件应尝试尽快成为交互式控件。

## <a name="colecontrolgetrectincontainer"></a><a name="getrectincontainer"></a>COle 控制：获取 rectin 容器

获取控件矩形相对于容器的坐标，以设备单位表示。

```
BOOL GetRectInContainer(LPRECT lpRect);
```

### <a name="parameters"></a>参数

*lpRect*<br/>
指向将控件的坐标复制到的矩形结构的指针。

### <a name="return-value"></a>返回值

如果控件处于活动位置，则非零;否则 0。

### <a name="remarks"></a>备注

仅当控件处于活动位置时，矩形才有效。

## <a name="colecontrolgetstocktextmetrics"></a><a name="getstocktextmetrics"></a>COleControl：获取股票文本指标

测量控件的股票字体属性的文本指标，可以使用[SelectStockFont](#selectstockfont)函数选择该参数。

```cpp
void GetStockTextMetrics(LPTEXTMETRIC lptm);
```

### <a name="parameters"></a>参数

*lptm*<br/>
指向[TEXTMETRIC](/windows/win32/api/wingdi/ns-wingdi-textmetricw)结构的指针。

### <a name="remarks"></a>备注

如果`GetStockTextMetrics`成功，`TEXTMETRIC`该函数将初始化*lptm*指向的结构，并包含有效的指标信息，如果成功，则用零填充结构。 在绘制控件时，请使用此函数而不是[GetTextMetrics，](/windows/win32/api/wingdi/nf-wingdi-gettextmetrics)因为控件（与任何嵌入的 OLE 对象）一样，可能需要将自己呈现为元文件。

调用`TEXTMETRIC``SelectStockFont`函数时刷新默认字体的结构。 只有在选择股票字体以确保它提供的信息有效后，才能调用此功能。

## <a name="colecontrolgettext"></a><a name="gettext"></a>COleControl：获取文本

实现库存文本或标题属性的获取函数。

```
BSTR GetText();
```

### <a name="return-value"></a>返回值

如果不存在字符串，则控件文本字符串或零长度字符串的当前值。

> [!NOTE]
> 有关 BSTR 数据类型的详细信息，请参阅宏和全局部分中的[数据类型](../../mfc/reference/data-types-mfc.md)。

### <a name="remarks"></a>备注

请注意，此函数的调用方必须调用`SysFreeString`返回的字符串才能释放资源。 在控件的实现中，用于`InternalGetText`访问控件的库存文本或标题属性。

## <a name="colecontrolgetwindowlessdroptarget"></a><a name="getwindowlessdroptarget"></a>COle 控制：获取无窗口丢弃目标

当`GetWindowlessDropTarget`希望无窗口控件成为 OLE 拖放操作的目标时，请进行覆盖。

```
virtual IDropTarget* GetWindowlessDropTarget();
```

### <a name="return-value"></a>返回值

指向对象的接口的`IDropTarget`指针。 由于它没有窗口，无窗口对象无法注册`IDropTarget`接口。 但是，要参与拖放，无窗口对象仍然可以实现接口并将其返回。 `GetWindowlessDropTarget`

### <a name="remarks"></a>备注

通常，这需要将该控件的窗口注册为放置目标。 但是，由于控件没有自己的窗口，容器将使用自己的窗口作为放置目标。 该控件只需要提供接口的实现，`IDropTarget`容器可以在适当的时间委派调用。 例如：

[!code-cpp[NVC_MFCAxCtl#2](../../mfc/reference/codesnippet/cpp/colecontrol-class_3.cpp)]

## <a name="colecontrolinitializeiids"></a><a name="initializeiids"></a>COle 控制：初始化 IID

通知控件将使用的 IID 的基类。

```cpp
void InitializeIIDs(
    const IID* piidPrimary,
    const IID* piidEvents);
```

### <a name="parameters"></a>参数

*皮迪小学*<br/>
指向控件主调度接口的接口 ID 的指针。

*皮迪活动*<br/>
指向控件事件接口的接口 ID 的指针。

### <a name="remarks"></a>备注

在控件的构造函数中调用此函数，以通知控件将使用的接口 I 的基类。

## <a name="colecontrolinternalgetfont"></a><a name="internalgetfont"></a>COleControl：内部获取字体

访问控件的库存字体属性

```
CFontHolder& InternalGetFont();
```

### <a name="return-value"></a>返回值

对包含库存字体对象的[CFontHolder](../../mfc/reference/cfontholder-class.md)对象的引用。

## <a name="colecontrolinternalgettext"></a><a name="internalgettext"></a>COleControl：内部获取文本

访问控件的库存文本或标题属性。

```
const CString& InternalGetText();
```

### <a name="return-value"></a>返回值

对控件文本字符串的引用。

## <a name="colecontrolinternalsetreadystate"></a><a name="internalsetreadystate"></a>COleControl：：内部就绪状态

设置控件的就绪状态。

```cpp
void InternalSetReadyState(long lNewReadyState);
```

### <a name="parameters"></a>参数

*l NewReadyState*<br/>
要为控件设置的准备状态，以下值之一：

|||
|-|-|
|READYSTATE_UNINITIALIZED|默认初始化状态|
|READYSTATE_LOADING|控件当前正在加载其属性|
|READYSTATE_LOADED|控件已初始化|
|READYSTATE_INTERACTIVE|控件有足够的数据是交互式的，但并非所有异步数据都已加载|
|READYSTATE_COMPLETE|控件具有所有数据|

### <a name="remarks"></a>备注

最简单的控件不需要区分 LOADED 和交互式。 但是，在至少以异步方式接收某些数据之前，支持数据路径属性的控件可能还没有准备好进行交互式访问。 控件应尝试尽快成为交互式控件。

## <a name="colecontrolinvalidatecontrol"></a><a name="invalidatecontrol"></a>COle 控制：无效控制

强制控件重新绘制自身。

```cpp
void InvalidateControl(
    LPCRECT lpRect = NULL,
    BOOL bErase = TRUE);
```

### <a name="parameters"></a>参数

*lpRect*<br/>
指向要失效的控件区域的指针。

*bErase*<br/>
指定在处理更新区域时是否擦除更新区域中的背景。

### <a name="remarks"></a>备注

如果*lpRect*具有 NULL 值，则将重绘整个控件。 如果*lpRect*不是 NULL，则表示控件矩形中要失效的部分。 如果控件没有窗口或当前未处于活动状态，则忽略矩形，并调用客户端站点的[IAdviseSink：：OnViewChange](/windows/win32/api/objidl/nf-objidl-iadvisesink-onviewchange)成员函数。 使用此函数而不是`CWnd::InvalidateRect`或`InvalidateRect`。

## <a name="colecontrolinvalidatergn"></a><a name="invalidatergn"></a>COleControl：无效

使给定区域内的容器窗口的工作区无效。

```cpp
void InvalidateRgn(CRgn* pRgn, BOOL bErase = TRUE);
```

### <a name="parameters"></a>参数

*pRgn*<br/>
指向[CRgn](../../mfc/reference/crgn-class.md)对象的指针，用于标识 OLE 对象的显示区域以在包含窗口的客户端坐标中失效。 如果此参数为 NULL，则范围为整个对象。

*bErase*<br/>
指定是否要擦除无效区域中的背景。 如果为 TRUE，则背景将被删除。 如果 FALSE，则背景保持不变。

### <a name="remarks"></a>备注

这可用于重绘容器中的无窗口控件。 在发送下一[WM_PAINT](/windows/win32/gdi/wm-paint)消息时，将标记无效区域以及更新区域中的所有其他区域进行绘制。

如果*bErase*对于更新区域的任何部分都为 TRUE，则整个区域（而不仅仅是给定部分）的背景将被删除。

## <a name="colecontrolisconvertingvbx"></a><a name="isconvertingvbx"></a>COleControl：正在转换VBX

允许专门加载 OLE 控件。

```
BOOL IsConvertingVBX();
```

### <a name="return-value"></a>返回值

如果要转换控件，则非零;否则 0。

### <a name="remarks"></a>备注

将使用 VBX 控件的窗体转换为使用 OLE 控件的窗体时，可能需要 OLE 控件的特殊加载代码。 例如，如果要加载 OLE 控件的实例，则可能会调用 中的`DoPropExchange`[PX_Font：](persistence-of-ole-controls.md#px_font)

[!code-cpp[NVC_MFCAxCtl#3](../../mfc/reference/codesnippet/cpp/colecontrol-class_4.cpp)]

但是，VBX 控件没有 Font 对象，因此，该控件没有"字体"对象。每个字体属性都单独保存。 在这种情况下，您将使用`IsConvertingVBX`来区分这两种情况：

[!code-cpp[NVC_MFCAxCtl#4](../../mfc/reference/codesnippet/cpp/colecontrol-class_5.cpp)]

另一种情况是，如果您的 VBX 控件保存了专有二进制数据（在其VBM_SAVEPROPERTY消息处理程序中），并且 OLE 控件以不同的格式保存其二进制数据。 如果希望 OLE 控件与 VBX 控件向后兼容，则可以通过区分是否加载 VBX 控件或 OLE`IsConvertingVBX`控件来读取使用函数读取新旧格式。

在控件的函数中`DoPropExchange`，可以检查此条件，如果为 true，则执行特定于此转换的负载代码（如前面的示例）。 如果未转换控件，则可以执行正常的加载代码。 此功能仅适用于从 VBX 对应控件转换的控件。

## <a name="colecontrolisinvokeallowed"></a><a name="isinvokeallowed"></a>COle 控制：被调用允许

启用自动化方法调用。

```
BOOL IsInvokeAllowed(DISPID dispid);
```

### <a name="return-value"></a>返回值

如果控件已初始化，则非零;否则 0。

### <a name="remarks"></a>备注

框架的调用`IDispatch::Invoke``IsInvokeAllowed`的实现，以确定是否可以调用给定函数（由`dispid`标识）。 OLE 控件的默认行为是仅在已初始化该控件时才允许调用自动化方法;但是，`IsInvokeAllowed`它是一个虚拟函数，如有必要可能会重写（例如，当控件用作自动化服务器时）。

## <a name="colecontrolismodified"></a><a name="ismodified"></a>COle 控制：已修改

确定控件的状态是否已被修改。

```
BOOL IsModified();
```

### <a name="return-value"></a>返回值

自上次保存控件状态以来已修改，则非零;否则 0。

### <a name="remarks"></a>备注

当属性更改值时，将修改控件的状态。

## <a name="colecontrolisoptimizeddraw"></a><a name="isoptimizeddraw"></a>COleControl：优化绘制

确定容器是否支持当前绘图操作的优化绘图。

```
BOOL IsOptimizedDraw();
```

### <a name="return-value"></a>返回值

如果容器支持针对当前绘图操作优化绘图，则为 TRUE;否则 FALSE。

### <a name="remarks"></a>备注

如果支持优化的绘图，则控件在绘制完成后不必在设备上下文中选择旧对象（笔、画笔、字体等）。

## <a name="colecontrolissubclassedcontrol"></a><a name="issubclassedcontrol"></a>COle 控制：是子类控制

由框架调用以确定控件是否对 Windows 控件进行子类。

```
virtual BOOL IsSubclassedControl();
```

### <a name="return-value"></a>返回值

如果控件被子类化，则非零;否则 0。

### <a name="remarks"></a>备注

如果 OLE 控件子类为 Windows 控件，则必须重写此函数并返回 TRUE。

## <a name="colecontrolload"></a><a name="load"></a>COle 控制：加载

以异步方式重置以前加载的任何数据，并启动控件的异步属性的新加载。

```cpp
void Load(LPCTSTR strNewPath, CDataPathProperty& prop);
```

### <a name="parameters"></a>参数

*斯特纽路径*<br/>
指向引用异步控件属性的绝对位置的路径的字符串的指针。

*支柱*<br/>
实现异步控件属性的[CDataPath 属性](../../mfc/reference/cdatapathproperty-class.md)对象。

## <a name="colecontrollockinplaceactive"></a><a name="lockinplaceactive"></a>COle 控制：锁定位置活动

防止容器停用控件。

```
BOOL LockInPlaceActive(BOOL bLock);
```

### <a name="parameters"></a>参数

*块*<br/>
如果要锁定控件的就地活动状态，则为 TRUE;如果要解锁，则 FALSE。

### <a name="return-value"></a>返回值

如果锁成功，则非零;否则 0。

### <a name="remarks"></a>备注

请注意，每次控制锁定都必须与完成控件的解锁配对。 应仅在短时间内锁定控件，例如触发事件时。

## <a name="colecontrolonambientpropertychange"></a><a name="onambientpropertychange"></a>COleControl：关于环境属性更改

当容器的环境属性已更改值时，由框架调用。

```
virtual void OnAmbientPropertyChange(DISPID dispid);
```

### <a name="parameters"></a>参数

*脱从ID*<br/>
已更改的环境属性的调度 ID，或者如果多个属性已更改，则DISPID_UNKNOWN。

## <a name="colecontrolonappearancechanged"></a><a name="onappearancechanged"></a>COle 控制：在外观上已更改

当股票外观属性值已更改时，由框架调用。

```
virtual void OnAppearanceChanged ();
```

### <a name="remarks"></a>备注

如果要在此属性更改后通知，则重写此函数。 默认实现调用`InvalidateControl`。

## <a name="colecontrolonbackcolorchanged"></a><a name="onbackcolorchanged"></a>COle 控制：onbackColor 已更改

当股票 BackColor 属性值已更改时，由框架调用。

```
virtual void OnBackColorChanged();
```

### <a name="remarks"></a>备注

如果要在此属性更改后通知，则重写此函数。 默认实现调用`InvalidateControl`。

## <a name="colecontrolonborderstylechanged"></a><a name="onborderstylechanged"></a>COle 控制：在边框样式上已更改

当股票 BorderStyle 属性值已更改时，由框架调用。

```
virtual void OnBorderStyleChanged();
```

### <a name="remarks"></a>备注

默认实现调用`InvalidateControl`。

如果要在此属性更改后通知，则重写此函数。

## <a name="colecontrolonclick"></a><a name="onclick"></a>COleControl：点击

当单击鼠标按钮或调用 DoClick 库存方法时，由框架调用。

```
virtual void OnClick(USHORT iButton);
```

### <a name="parameters"></a>参数

*iButton*<br/>
鼠标按钮的索引。 可以是下列值之一：

- LEFT_BUTTON单击鼠标左键。

- MIDDLE_BUTTON单击鼠标中间键。

- RIGHT_BUTTON单击了鼠标右键。

### <a name="remarks"></a>备注

默认实现调用`COleControl::FireClick`。

重写此成员函数以修改或扩展默认处理。

## <a name="colecontrolonclose"></a><a name="onclose"></a>COle 控制：关闭

当容器调用控件的`IOleControl::Close`函数时，由框架调用。

```
virtual void OnClose(DWORD dwSaveOption);
```

### <a name="parameters"></a>参数

*dwSaveOption*<br/>
指示是否应在加载之前保存对象的标志。 有效值是：

- OLECLOSE_SAVEIFDIRTY

- OLECLOSE_NOSAVE

- OLECLOSE_PROMPTSAVE

### <a name="remarks"></a>备注

默认情况下，`OnClose`如果控件对象已被修改，*并且 dwSaveOption* OLECLOSE_SAVEIFDIRTY或OLECLOSE_PROMPTSAVE，则保存该控件对象。

## <a name="colecontrolondoverb"></a><a name="ondoverb"></a>COleControl：OnDoVerb

当容器调用`IOleObject::DoVerb`成员函数时由框架调用。

```
virtual BOOL OnDoVerb(
    LONG iVerb,
    LPMSG lpMsg,
    HWND hWndParent,
    LPCRECT lpRect);
```

### <a name="parameters"></a>参数

*iVerb*<br/>
要调用的控件谓词的索引。

*lpMsg*<br/>
指向导致调用谓词的 Windows 消息的指针。

*hWnd 父母*<br/>
控件父窗口的句柄。 如果动词的执行创建了一个窗口（或窗口），则应将*hWndParent*用作父项。

*lpRect*<br/>
指向 RECT 结构的指针，将控件的坐标（相对于容器）复制到该结构中。

### <a name="return-value"></a>返回值

如果调用成功，则为非零;否则 0。

### <a name="remarks"></a>备注

默认实现使用ON_OLEVERB和ON_STDOLEVERB消息映射条目来确定要调用的正确函数。

重写此函数以更改动词的默认处理。

## <a name="colecontrolondraw"></a><a name="ondraw"></a>COleControl：在画上

由框架调用，使用指定的设备上下文在指定的边界矩形中绘制 OLE 控件。

```
virtual void OnDraw(
    CDC* pDC,
    const CRect& rcBounds,
    const CRect& rcInvalid);
```

### <a name="parameters"></a>参数

*pDC*<br/>
发生绘图的设备上下文。

*rcBunds*<br/>
控件的矩形区域，包括边框。

*rc 无效*<br/>
控件无效的矩形区域。

### <a name="remarks"></a>备注

`OnDraw`通常要求屏幕显示，传递屏幕设备上下文为*pDC。* *rcBounds*参数标识目标设备上下文中的矩形（相对于其当前映射模式）。 *rcInvalid*参数是无效的实际矩形。 在某些情况下，这将是一个比*rcBounds*更小的区域。

## <a name="colecontrolondrawmetafile"></a><a name="ondrawmetafile"></a>COleControl：在画元文件

由框架调用，使用指定的元文件设备上下文在指定的边界矩形中绘制 OLE 控件。

```
virtual void OnDrawMetafile(
    CDC* pDC,
    const CRect& rcBounds);
```

### <a name="parameters"></a>参数

*pDC*<br/>
发生绘图的设备上下文。

*rcBunds*<br/>
控件的矩形区域，包括边框。

### <a name="remarks"></a>备注

默认实现调用[OnDraw](#ondraw)函数。

## <a name="colecontrolonedit"></a><a name="onedit"></a>COleControl：：编辑

使控件被激活。

```
virtual BOOL OnEdit(
    LPMSG lpMsg,
    HWND hWndParent,
    LPCRECT lpRect);
```

### <a name="parameters"></a>参数

*lpMsg*<br/>
指向调用谓词的 Windows 消息的指针。

*hWnd 父母*<br/>
控件的父窗口的句柄。

*lpRect*<br/>
指向容器中控件使用的矩形的指针。

### <a name="return-value"></a>返回值

如果调用成功，则非零;否则 0。

### <a name="remarks"></a>备注

这与调用控件的OLEIVERB_UIACTIVATE谓词的效果相同。

此函数通常用作ON_OLEVERB消息映射条目的处理程序函数。 这使控件的"对象"菜单上有"编辑"谓词可用。 例如：

[!code-cpp[NVC_MFCAxCtl#5](../../mfc/reference/codesnippet/cpp/colecontrol-class_6.cpp)]

## <a name="colecontrolonenabledchanged"></a><a name="onenabledchanged"></a>COle 控制：启用

当股票启用属性值已更改时，由框架调用。

```
virtual void OnEnabledChanged();
```

### <a name="remarks"></a>备注

如果要在此属性更改后通知，则重写此函数。 默认实现调用[无效控制](#invalidatecontrol)。

## <a name="colecontrolonenumverbs"></a><a name="onenumverbs"></a>COleControl：onEnumVerbs

当容器调用`IOleObject::EnumVerbs`成员函数时由框架调用。

```
virtual BOOL OnEnumVerbs(LPENUMOLEVERB* ppenumOleVerb);
```

### <a name="parameters"></a>参数

*佩纳姆奥勒Verb*<br/>
指向枚举控件`IEnumOLEVERB`谓词的对象的指针。

### <a name="return-value"></a>返回值

如果动词可用，则非零;否则 0。

### <a name="remarks"></a>备注

默认实现枚举消息映射中ON_OLEVERB项。

重写此函数以更改枚举谓词的默认方式。

## <a name="colecontroloneventadvise"></a><a name="oneventadvise"></a>COleControl：在事件建议

当事件处理程序连接到 OLE 控件或与 OLE 控件断开连接时，由框架调用。

```
virtual void OnEventAdvise(BOOL bAdvise);
```

### <a name="parameters"></a>参数

*b 建议*<br/>
TRUE 表示事件处理程序已连接到控件。 FALSE 表示事件处理程序已断开与控件的连接。

## <a name="colecontrolonfontchanged"></a><a name="onfontchanged"></a>COleControl：：放大缩小字体功能 放大缩小字体功能

当股票字体属性值已更改时，由框架调用。

```
virtual void OnFontChanged();
```

### <a name="remarks"></a>备注

默认实现调用`COleControl::InvalidateControl`。 如果控件正在对 Windows 控件进行子类化，则默认实现还会向控件的窗口发送WM_SETFONT消息。

如果要在此属性更改后通知，则重写此函数。

### <a name="example"></a>示例

[!code-cpp[NVC_MFCAxCtl#6](../../mfc/reference/codesnippet/cpp/colecontrol-class_7.cpp)]

## <a name="colecontrolonforecolorchanged"></a><a name="onforecolorchanged"></a>COleControl：OnforeColor 已更改

当股票 ForeColor 属性值已更改时，由框架调用。

```
virtual void OnForeColorChanged();
```

### <a name="remarks"></a>备注

默认实现调用`InvalidateControl`。

如果要在此属性更改后通知，则重写此函数。

## <a name="colecontrolonfreezeevents"></a><a name="onfreezeevents"></a>COleControl：在冻结事件

在容器调用 后由框架调用`IOleControl::FreezeEvents`。

```
virtual void OnFreezeEvents(BOOL bFreeze);
```

### <a name="parameters"></a>参数

*bFreeze*<br/>
如果控件的事件处理被冻结，则为 TRUE;否则 FALSE。

### <a name="remarks"></a>备注

默认实现不执行任何操作。

如果要在冻结或解冻事件处理时执行其他行为，则重写此函数。

## <a name="colecontrolongetcolorset"></a><a name="ongetcolorset"></a>COleControl：onGetColorSet

当容器调用`IViewObject::GetColorSet`成员函数时由框架调用。

```
virtual BOOL OnGetColorSet(
    DVTARGETDEVICE* ptd,
    HDC hicTargetDev,
    LPLOGPALETTE* ppColorSet);
```

### <a name="parameters"></a>参数

*ptd*<br/>
指向应为其呈现图片的目标设备。 如果此值为 NULL，则应为默认目标设备（通常是显示设备）呈现图片。

*希塔吉特德夫*<br/>
指定*ptd*指示的目标设备上的信息上下文。 此参数可以是设备上下文，但不一定是设备上下文。 如果*ptd*为 NULL，*则 hicTargetDev*也应为 NULL。

*ppColorSet*<br/>
指向应使用颜色集的位置的指针。 如果函数不返回颜色集，则返回 NULL。

### <a name="return-value"></a>返回值

如果返回有效颜色集，则非零;否则 0。

### <a name="remarks"></a>备注

容器调用此函数以获取绘制 OLE 控件所需的所有颜色。 容器可以使用与设置整体调色板所需的颜色一起获取的颜色集。 默认实现返回 FALSE。

重写此函数以执行此请求的任何特殊处理。

## <a name="colecontrolongetcontrolinfo"></a><a name="ongetcontrolinfo"></a>COleControl：OnGetControlInfo

当控件的容器请求有关控件的信息时，由框架调用。

```
virtual void OnGetControlInfo(LPCONTROLINFO pControlInfo);
```

### <a name="parameters"></a>参数

*pControlInfo*<br/>
指向要填充[的 CONTROLINFO](/windows/win32/api/ocidl/ns-ocidl-controlinfo)结构的指针。

### <a name="remarks"></a>备注

此信息主要包括控件的助记符键的说明。 默认实现使用默认信息填充*pControlInfo。*

如果控件需要处理助记符键，请覆盖此函数。

## <a name="colecontrolongetdisplaystring"></a><a name="ongetdisplaystring"></a>COle 控制：：在GetDisplayString上

由框架调用以获取表示由*dispid*标识的属性的当前值的字符串。

```
virtual BOOL OnGetDisplayString(
    DISPID dispid,
    CString& strValue);
```

### <a name="parameters"></a>参数

*不一部分*<br/>
该控件的属性的调度 ID。

*strValue*<br/>
对[CString](../../atl-mfc-shared/reference/cstringt-class.md)对象的引用，通过该对象将返回字符串。

### <a name="return-value"></a>返回值

如果字符串在*strValue*中返回，则非零;否则为 0。

### <a name="remarks"></a>备注

如果控件具有其值不能直接转换为字符串的属性，并且希望该属性的值显示在容器提供的属性浏览器中，请覆盖此函数。

## <a name="colecontrolongetinplacemenu"></a><a name="ongetinplacemenu"></a>COleControl：ongetinplacemenu

当控件被 UI 激活以获取要合并到容器的现有菜单中的菜单时，由框架调用。

```
virtual HMENU OnGetInPlaceMenu();
```

### <a name="return-value"></a>返回值

控件菜单的句柄，如果控件没有，则为 NULL。 默认实现返回 NULL。

### <a name="remarks"></a>备注

有关合并 OLE 资源的详细信息，请参阅文章["菜单和资源 "（OLE）](../../mfc/menus-and-resources-ole.md)"。

## <a name="colecontrolongetnaturalextent"></a><a name="ongetnaturalextent"></a>COleControl：OnGet自然范围

框架响应容器`IViewObjectEx::GetNaturalExtent`请求调用。

```
virtual BOOL OnGetNaturalExtent(
    DWORD dwAspect,
    LONG lindex,
    DVTARGETDEVICE* ptd,
    HDC hicTargetDev,
    DVEXTENTINFO* pExtentInfo,
    LPSIZEL psizel);
```

### <a name="parameters"></a>参数

*dwAspect*<br/>
指定要如何表示该对象。 表示形式包括内容、图标、缩略图或打印文档。 有效值取自枚举[DVASPECT](/windows/win32/api/wtypes/ne-wtypes-dvaspect)或 DVASPECT2。

*利索引*<br/>
感兴趣的对象的部分。 目前只有 -1 有效。

*ptd*<br/>
指向定义应为其返回对象大小的目标设备的[DVTARGETDEVICE](/windows/win32/api/objidl/ns-objidl-dvtargetdevice)结构。

*希塔吉特德夫*<br/>
指定*由 ptd*参数指示的目标设备的信息上下文，对象可以从中提取设备指标并测试设备的功能。 如果*ptd*为 NULL，则对象应忽略*hicTargetDev*参数中的值。

*p 范围信息*<br/>
指向`DVEXTENTINFO`指定大小调整的数据的结构。 结构`DVEXTENTINFO`为：

```cpp
typedef struct tagExtentInfo
{
    UINT cb;
    DWORD dwExtentMode;
    SIZEL sizelProposed;
}   DVEXTENTINFO;
```

结构成员`dwExtentMode`可以采用两个值之一：

- DVEXTENT_CONTENT查询控件应有多大以完全适合内容（对齐大小）

- DVEXTENT_INTEGRAL调整大小时，将建议的大小传递给控件

*普西斯尔*<br/>
点以调整控件返回的数据大小。 对于任何未调整的维度，返回的尺寸调整数据设置为 -1。

### <a name="return-value"></a>返回值

如果成功返回或调整大小，则非零;否则 0。

### <a name="remarks"></a>备注

重写此函数以返回对象的显示大小，最接近`DVEXTENTINFO`结构中建议的大小和范围模式。 默认实现返回 FALSE，不调整大小。

## <a name="colecontrolongetpredefinedstrings"></a><a name="ongetpredefinedstrings"></a>COle 控制：：打开预定义字符串

由框架调用以获取一组预定义字符串，表示属性的可能值。

```
virtual BOOL OnGetPredefinedStrings(
    DISPID dispid,
    CStringArray* pStringArray,
    CDWordArray* pCookieArray);
```

### <a name="parameters"></a>参数

*不一部分*<br/>
该控件的属性的调度 ID。

*pStringarray*<br/>
要用返回值填充的字符串数组。

*pCookiearray*<br/>
要用返回值填充的 DWORD 数组。

### <a name="return-value"></a>返回值

如果元素已添加到*pStringarray*和*pCookiearray*，则非零。

### <a name="remarks"></a>备注

如果控件具有一组可以由字符串表示的可能值的属性，请覆盖此函数。 对于添加到*pStringArray*的每个元素，应向*pCookiearray*添加相应的"cookie"元素。 这些"cookie"值稍后可能会由框架传递给函数`COleControl::OnGetPredefinedValue`。

## <a name="colecontrolongetpredefinedvalue"></a><a name="ongetpredefinedvalue"></a>COle 控制：：获取预定义值

由 框架调用以获取与以前由 重写返回的预定义字符串之一对应的值`COleControl::OnGetPredefinedStrings`。

```
virtual BOOL OnGetPredefinedValue(
    DISPID dispid,
    DWORD dwCookie,
    VARIANT* lpvarOut);
```

### <a name="parameters"></a>参数

*不一部分*<br/>
该控件的属性的调度 ID。

*dwCookie*<br/>
以前由 重写返回的`COleControl::OnGetPredefinedStrings`Cookie 值。

*lpvarOut*<br/>
指向将返回`VARIANT`属性值的结构的指针。

### <a name="return-value"></a>返回值

如果以*lpvarOut*中返回值，则非零。否则 0。

## <a name="colecontrolongetviewextent"></a><a name="ongetviewextent"></a>COleControl：OngetView 范围

由框架调用以响应容器的[IViewObject2：：：get 范围](/windows/win32/api/oleidl/nf-oleidl-iviewobject2-getextent)请求。

```
virtual BOOL OnGetViewExtent(
    DWORD dwDrawAspect,
    LONG lindex,
    DVTARGETDEVICE* ptd,
    LPSIZEL lpsizel);
```

### <a name="parameters"></a>参数

*dwDrawAspect*<br/>
DWORD 描述要显示对象的窗体或方面。 有效值取自枚举[DVASPECT](/windows/win32/api/wtypes/ne-wtypes-dvaspect)或 DVASPECT2。

*利索引*<br/>
感兴趣的对象的部分。 目前只有 -1 有效。

*ptd*<br/>
指向定义应为其返回对象大小的目标设备的[DVTARGETDEVICE](/windows/win32/api/objidl/ns-objidl-dvtargetdevice)结构。

*lpsizel*<br/>
指向返回对象大小的位置。

### <a name="return-value"></a>返回值

如果成功返回范围信息，则非零;否则 0。

### <a name="remarks"></a>备注

如果控件使用双通道绘图，并且其不透明和透明零件具有不同的尺寸，则覆盖此函数。

## <a name="colecontrolongetviewrect"></a><a name="ongetviewrect"></a>COleControl：OngetViewrect

框架响应容器`IViewObjectEx::GetRect`请求调用。

```
virtual BOOL OnGetViewRect(DWORD dwAspect, LPRECTL pRect);
```

### <a name="parameters"></a>参数

*dwAspect*<br/>
DWORD 描述要显示对象的窗体或方面。 有效值取自枚举[DVASPECT 或](/windows/win32/api/wtypes/ne-wtypes-dvaspect)DVASPECT2：

- DVASPECT_CONTENT整个对象的边界矩形。 对象原点和大小处的左上角等于 返回的范围`GetViewExtent`*。*

- DVASPECT_OPAQUE具有矩形不透明区域的对象返回该矩形。 其他人失败了。

- DVASPECT_TRANSPARENT矩形，覆盖所有透明或不规则零件。

*普雷克*<br/>
指向指定在其中绘制对象的矩形的[RECTL](/windows/win32/api/windef/ns-windef-rectl)结构。 此参数控制对象的定位和拉伸。

### <a name="return-value"></a>返回值

如果成功返回到对象的矩形大小，则非零;否则 0。

### <a name="remarks"></a>备注

对象的大小由`OnGetViewRect`从特定位置开始的矩形转换为矩形（默认值为显示的左上角）。 如果控件使用双通道绘图，并且其不透明和透明零件具有不同的尺寸，则覆盖此函数。

## <a name="colecontrolongetviewstatus"></a><a name="ongetviewstatus"></a>COleControl：Onget查看状态

框架响应容器`IViewObjectEx::GetViewStatus`请求调用。

```
virtual DWORD OnGetViewStatus();
```

### <a name="return-value"></a>返回值

如果成功，则视图状态枚举的值之一;否则 0。 可能的值是以下任意组合：

|||
|-|-|
|VIEWSTATUS_OPAQUE|对象是完全不透明的。 如果未设置此位，则对象包含透明部分。 此位仅适用于与内容相关的方面，不适用于DVASPECT_ICON或DVASPECT_DOCPRINT。|
|VIEWSTATUS_SOLIDBKGND|对象具有纯背景（以纯色而不是画笔图案组成）。 仅当设置VIEWSTATUS_OPAQUE且仅适用于内容相关方面，而不是应用于DVASPECT_ICON或DVASPECT_DOCPRINT时，此位才有意义。|
|VIEWSTATUS_DVASPECTOPAQUE|对象支持DVASPECT_OPAQUE。 使用此方面可以调用所有以绘图方面作为参数的 IViewObjectEx 方法。|
|VIEWSTATUS_DVASPECTTRANSPARENT|对象支持DVASPECT_TRANSPARENT。 可以`IViewObjectEx`使用此方面调用所有以绘图方面为参数的方法。|

### <a name="remarks"></a>备注

如果控件使用双通道绘图，请覆盖此函数。 默认实现返回VIEWSTATUS_OPAQUE。

## <a name="colecontrolonhidetoolbars"></a><a name="onhidetoolbars"></a>COle 控制：在隐藏工具栏上

当控件被 UI 停用时，由框架调用。

```
virtual void OnHideToolBars();
```

### <a name="remarks"></a>备注

实现应隐藏 显示`OnShowToolbars`的所有工具栏。

## <a name="colecontroloninactivemousemove"></a><a name="oninactivemousemove"></a>COle 控制：在活动鼠标移动

收到WM_MOUSEMOVE消息时，容器为鼠标指针下的非活动对象调用。

```
virtual void OnInactiveMouseMove(
    LPCRECT lprcBounds,
    long x,
    long y,
    DWORD dwKeyState);
```

### <a name="parameters"></a>参数

*lprcBounds*<br/>
包含窗口的客户端坐标中的对象边界矩形。 收到WM_MOUSEMOVE消息时，告诉对象其在屏幕上的确切位置和大小。

*x*<br/>
包含窗口的客户端坐标中的鼠标位置的 x 坐标。

*Y*<br/>
包含窗口的客户端坐标中的鼠标位置的 y 坐标。

*德基州*<br/>
标识键盘上键盘修改器键的当前状态。 有效值可以是任何标志MK_CONTROL、MK_SHIFT、MK_ALT、MK_BUTTON、MK_LBUTTON、MK_MBUTTON和MK_RBUTTON的组合。

### <a name="remarks"></a>备注

请注意，窗口客户端坐标（像素）用于传递鼠标光标位置。 这可以通过在同一坐标系中传递对象的边界矩形来实现。

## <a name="colecontroloninactivesetcursor"></a><a name="oninactivesetcursor"></a>COle 控制：oninactiveSetCursor

收到WM_SETCURSOR消息时，容器在鼠标指针下为非活动对象调用。

```
virtual BOOL OnInactiveSetCursor(
    LPCRECT lprcBounds,
    long x,
    long y,
    DWORD dwMouseMsg,
    BOOL bSetAlways);
```

### <a name="parameters"></a>参数

*lprcBounds*<br/>
包含窗口的客户端坐标中的对象边界矩形。 收到WM_SETCURSOR消息时，告诉对象其在屏幕上的确切位置和大小。

*x*<br/>
包含窗口的客户端坐标中的鼠标位置的 x 坐标。

*Y*<br/>
包含窗口的客户端坐标中的鼠标位置的 y 坐标。

*dwMouseMsg*<br/>
发生WM_SETCURSOR的鼠标消息的标识符。

*bSetAlways*<br/>
指定对象是否必须设置游标。 如果为 TRUE，则对象必须设置游标;如果为 TRUE，则对象必须设置光标。如果 FALSE，游标没有义务设置游标，在这种情况下应返回S_FALSE。

### <a name="return-value"></a>返回值

如果成功，则不为 0；否则为 0。

### <a name="remarks"></a>备注

请注意，窗口客户端坐标（像素）用于传递鼠标光标位置。 这可以通过在同一坐标系中传递对象的边界矩形来实现。

## <a name="colecontrolonkeydownevent"></a><a name="onkeydownevent"></a>COleControl：在键下事件

处理股票密钥下事件后由框架调用。

```
virtual void OnKeyDownEvent(
    USHORT nChar,
    USHORT nShiftState);
```

### <a name="parameters"></a>参数

*n查尔*<br/>
按下密钥的虚拟密钥代码值。 有关标准虚拟密钥代码的列表，请参阅 Winuser.h

*nShiftState*<br/>
包含以下标志的组合：

- SHIFT_MASK在操作过程中按下 SHIFT 键。

- CTRL_MASK在操作期间按下了 CTRL 键。

- ALT_MASK在操作过程中按下 ALT 键。

### <a name="remarks"></a>备注

如果控件需要在触发事件后访问密钥信息，请覆盖此函数。

## <a name="colecontrolonkeypressevent"></a><a name="onkeypressevent"></a>COleControl：：在KeyPress事件

在股票 KeyPress 事件已触发后，由框架调用。

```
virtual void OnKeyPressEvent(USHORT nChar);
```

### <a name="parameters"></a>参数

*n查尔*<br/>
包含按下的密钥的虚拟密钥代码值。 有关标准虚拟密钥代码的列表，请参阅 Winuser.h

### <a name="remarks"></a>备注

请注意，容器可能已修改*nChar*值。

如果要在此事件发生后发出通知，请覆盖此函数。

## <a name="colecontrolonkeyupevent"></a><a name="onkeyupevent"></a>COleControl：在KeyUpevent上

处理股票密钥下事件后由框架调用。

```
virtual void OnKeyUpEvent(
    USHORT nChar,
    USHORT nShiftState);
```

### <a name="parameters"></a>参数

*n查尔*<br/>
按下密钥的虚拟密钥代码值。 有关标准虚拟密钥代码的列表，请参阅 Winuser.h

*nShiftState*<br/>
包含以下标志的组合：

- SHIFT_MASK在操作过程中按下 SHIFT 键。

- CTRL_MASK在操作期间按下了 CTRL 键。

- ALT_MASK在操作过程中按下 ALT 键。

### <a name="remarks"></a>备注

如果控件需要在触发事件后访问密钥信息，请覆盖此函数。

## <a name="colecontrolonmappropertytopage"></a><a name="onmappropertytopage"></a>COleControl：在地图属性页

由框架调用以获取实现编辑指定属性的属性页的类 ID。

```
virtual BOOL OnMapPropertyToPage(
    DISPID dispid,
    LPCLSID lpclsid,
    BOOL* pbPageOptional);
```

### <a name="parameters"></a>参数

*不一部分*<br/>
该控件的属性的调度 ID。

*lpclsid*<br/>
指向将返回`CLSID`类 ID 的结构的指针。

*pbPage 可选*<br/>
返回指定属性页的使用是否可选的指示器。

### <a name="return-value"></a>返回值

如果以*lpclsid*中返回类 ID，则非零。否则 0。

### <a name="remarks"></a>备注

重写此函数，提供从容器的属性浏览器调用控件的属性页的方法。

## <a name="colecontrolonmnemonic"></a><a name="onmnemonic"></a>COleControl：onMnemonic

当容器检测到已按下 OLE 控件的助记符键时，由框架调用。

```
virtual void OnMnemonic(LPMSG pMsg);
```

### <a name="parameters"></a>参数

*pMsg*<br/>
一个指针，指向由助记键按键操作生成的 Windows 消息。

## <a name="colecontrolonproperties"></a><a name="onproperties"></a>COle 控制：：属性

当容器调用控件的属性谓词时，由框架调用。

```
virtual BOOL OnProperties(
    LPMSG lpMsg,
    HWND hWndParent,
    LPCRECT lpRect);
```

### <a name="parameters"></a>参数

*lpMsg*<br/>
指向调用谓词的 Windows 消息的指针。

*hWnd 父母*<br/>
控件的父窗口的句柄。

*lpRect*<br/>
指向容器中控件使用的矩形的指针。

### <a name="return-value"></a>返回值

如果调用成功，则非零;否则 0。

### <a name="remarks"></a>备注

默认实现显示一个模态属性对话框。

您还可以使用此功能来显示控件的属性页。 调用函数，`OnProperties`在*hWndParent*参数中传递控件父项的句柄。 在这种情况下 *，lpMsg*和*lpRect*参数的值将被忽略。

## <a name="colecontrolonqueryhitpoint"></a><a name="onqueryhitpoint"></a>COle 控制：在查询命中点

框架响应容器`IViewObjectEx::QueryHitPoint`请求调用。

```
virtual BOOL OnQueryHitPoint(
    DWORD dwAspect,
    LPCRECT pRectBounds,
    POINT ptlLoc,
    LONG lCloseHint,
    DWORD* pHitResult);
```

### <a name="parameters"></a>参数

*dwAspect*<br/>
指定对象的表示方式。 有效值取自枚举[DVASPECT](/windows/win32/api/wtypes/ne-wtypes-dvaspect)或 DVASPECT2。

*pRectBounds*<br/>
指向指定`RECT`OLE 控制工作区边界矩形的结构的指针。

*普特洛克*<br/>
指向结构的`POINT`指针，指定要检查的点进行命中。 该点在 OLE 工作区坐标中指定。

*l 关闭提示*<br/>
定义"接近"到已检查命中点的距离。

*pHitResult*<br/>
指向命中查询结果的指针。 以下值之一：

- HITRESULT_OUTSIDE *ptlLoc*位于 OLE 对象外部，不关闭。

- HITRESULT_TRANSPARENT *ptlLoc*在 OLE 对象的边界内，但不靠近图像。 例如，可以HITRESULT_TRANSPARENT透明圆中间的点。

- HITRESULT_CLOSE *ptlLoc*位于 OLE 对象内部或外部，但足够靠近对象，可考虑内部。 小对象、细对象或详细对象可能会使用此值。 即使某个点位于对象的边界矩形之外，它也可能仍然接近（这是命中小对象所必需的）。

- HITRESULT_HIT *ptlLoc*位于对象的图像中。

### <a name="return-value"></a>返回值

成功返回命中结果时非零;否则 0。 命中与 OLE 控制显示区域重叠。

### <a name="remarks"></a>备注

查询对象的显示矩形是否与给定点重叠（点击点）。 `QueryHitPoint`可以重写以测试非矩形对象的命中。

## <a name="colecontrolonqueryhitrect"></a><a name="onqueryhitrect"></a>COleControl：在查询中

框架响应容器`IViewObjectEx::QueryHitRect`请求调用。

```
virtual BOOL OnQueryHitRect(
    DWORD dwAspect,
    LPCRECT pRectBounds,
    LPCRECT prcLoc,
    LONG lCloseHint,
    DWORD* pHitResult);
```

### <a name="parameters"></a>参数

*dwAspect*<br/>
指定要如何表示该对象。 有效值取自枚举[DVASPECT](/windows/win32/api/wtypes/ne-wtypes-dvaspect)或 DVASPECT2。

*pRectBounds*<br/>
指向指定`RECT`OLE 控制工作区边界矩形的结构的指针。

*prcLoc*<br/>
指向`RECT`指定要检查的矩形以进行命中（与对象矩形重叠）相对于对象的左上角的指针。

*l 关闭提示*<br/>
未使用。

*pHitResult*<br/>
指向命中查询结果的指针。 以下值之一：

- HITRESULT_OUTSIDE OLE 对象不会命中矩形中的点。

- HITRESULT_HIT矩形中至少有一个点是对象的命中。

### <a name="return-value"></a>返回值

成功返回命中结果时非零;否则 0。

### <a name="remarks"></a>备注

查询对象的显示矩形是否与给定矩形中的任何点重叠（点击矩形）。 `QueryHitRect`可以重写以测试非矩形对象的命中。

## <a name="colecontrolonrenderdata"></a><a name="onrenderdata"></a>COle 控制：在渲染数据上

框架调用以检索指定格式的数据。

```
virtual BOOL OnRenderData(
    LPFORMATETC lpFormatEtc,
    LPSTGMEDIUM lpStgMedium);
```

### <a name="parameters"></a>参数

*lpFormatEtc*<br/>
指向[FORMATETC](/windows/win32/api/objidl/ns-objidl-formatetc)结构，指定请求信息的格式。

*lpStg 中*<br/>
指向要返回数据的[STGMEDIUM](/windows/win32/api/objidl/ns-objidl-ustgmedium~r1)结构。

### <a name="return-value"></a>返回值

如果成功，则不为 0；否则为 0。

### <a name="remarks"></a>备注

指定的格式是以前使用[延迟渲染数据](../../mfc/reference/coledatasource-class.md#delayrenderdata)或[延迟渲染文件](../../mfc/reference/coledatasource-class.md#delayrenderfiledata)成员函数放置在控件对象中的格式，用于延迟渲染。 如果提供的存储介质是文件或`OnRenderFileData`内存`OnRenderGlobalData`，则此函数的默认实现将调用 或 。。" 如果请求的格式CF_METAFILEPICT或持久属性集格式，则默认实现呈现适当的数据并返回非零。 否则，它将返回 0，并且不执行任何操作。

如果*lpStg中>tymedTYMED_NULL，* 则STGMEDIUM应按*lpFormatEtc->tymed*指定分配和填充。 如果不TYMED_NULL，则 STGMEDIUM 应随数据一起填充。

重写此函数以请求的格式和介质提供数据。 根据数据的不同，您可能希望重写此函数的其他版本之一。 如果数据较小且大小固定，请重写`OnRenderGlobalData`。 如果数据位于文件中，或者大小可变，请重写`OnRenderFileData`。

有关详细信息，请参阅 Windows `FORMATETC` SDK`STGMEDIUM`中的 和 结构。

## <a name="colecontrolonrenderfiledata"></a><a name="onrenderfiledata"></a>COle 控制：在渲染文件数据上

当存储介质是文件时，框架调用以指定格式检索数据。

```
virtual BOOL OnRenderFileData(
    LPFORMATETC lpFormatEtc,
    CFile* pFile);
```

### <a name="parameters"></a>参数

*lpFormatEtc*<br/>
指向[FORMATETC](/windows/win32/api/objidl/ns-objidl-formatetc)结构，指定请求信息的格式。

*pFile*<br/>
指向要呈现数据的[CFile](../../mfc/reference/cfile-class.md)对象。

### <a name="return-value"></a>返回值

如果成功，则不为 0；否则为 0。

### <a name="remarks"></a>备注

指定的格式是以前使用[DelayRenderData](../../mfc/reference/coledatasource-class.md#delayrenderdata)成员函数放置在控件对象中的格式，用于延迟渲染。 此函数的默认实现仅返回 FALSE。

重写此函数以请求的格式和介质提供数据。 根据数据的不同，您可能希望重写此函数的其他版本之一。 如果要处理多个存储介质，则重写`OnRenderData`。 如果数据位于文件中，或者大小可变，请重写`OnRenderFileData`。

有关详细信息，请参阅 Windows `FORMATETC` SDK 中的结构。

## <a name="colecontrolonrenderglobaldata"></a><a name="onrenderglobaldata"></a>COle 控制：在渲染全局数据

当指定的存储介质是全局内存时，框架调用以指定格式检索数据。

```
virtual BOOL OnRenderGlobalData(
    LPFORMATETC lpFormatEtc,
    HGLOBAL* phGlobal);
```

### <a name="parameters"></a>参数

*lpFormatEtc*<br/>
指向[FORMATETC](/windows/win32/api/objidl/ns-objidl-formatetc)结构，指定请求信息的格式。

*phGlobal*<br/>
指向要返回数据的全局内存的句柄。 如果未分配内存，则此参数可以是 NULL。

### <a name="return-value"></a>返回值

如果成功，则不为 0；否则为 0。

### <a name="remarks"></a>备注

指定的格式是以前使用[DelayRenderData](../../mfc/reference/coledatasource-class.md#delayrenderdata)成员函数放置在控件对象中的格式，用于延迟渲染。 此函数的默认实现仅返回 FALSE。

如果*phGlobal*为 NULL，则应在 phGLOBAL 中分配并返回新的*HGLOBAL。* 否则 *，phGLOBAL*指定的 HGLOBAL 应填充数据。 放置在 HGLOBAL 中的数据量不得超过内存块的当前大小。 此外，块无法重新分配到更大的大小。

重写此函数以请求的格式和介质提供数据。 根据数据的不同，您可能希望重写此函数的其他版本之一。 如果要处理多个存储介质，则重写`OnRenderData`。 如果数据位于文件中，或者大小可变，请重写`OnRenderFileData`。

有关详细信息，请参阅 Windows `FORMATETC` SDK 中的结构。

## <a name="colecontrolonresetstate"></a><a name="onresetstate"></a>COle 控制：在重置状态

当控件的属性应设置为其默认值时，由框架调用。

```
virtual void OnResetState();
```

### <a name="remarks"></a>备注

默认实现称为[DoPropExchange，](#dopropexchange)传递导致`CPropExchange`属性设置为其默认值的对象。

控件编写器可以在此可重写中插入 OLE 控件的初始化代码。 当[IPersistStream：：加载](/windows/win32/api/objidl/nf-objidl-ipersiststream-load)或[I持久存储：加载](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load)失败，或[IPersistStreaminit：：Ininnew](/windows/win32/api/ocidl/nf-ocidl-ipersiststreaminit-initnew)或[IpersistStorage：：InitNew](/windows/win32/api/objidl/nf-objidl-ipersiststorage-initnew)调用时，调用此函数`IPersistStream::Load`，`IPersistStorage::Load`无需首先调用或 调用 。

## <a name="colecontrolonsetclientsite"></a><a name="onsetclientsite"></a>COleControl：在设置客户端站点

当容器调用控件的`IOleControl::SetClientSite`函数时，由框架调用。

```
virtual void OnSetClientSite();
```

### <a name="remarks"></a>备注

默认情况下，`OnSetClientSite`检查是否加载数据路径属性，如果是否加载，则调用`DoDataPathPropExchange`。

重写此函数以执行此通知的任何特殊处理。 特别是，此函数的重写应调用基类。

## <a name="colecontrolonsetdata"></a><a name="onsetdata"></a>COleControl：OnSetData

由框架调用以将控件的数据替换为指定数据。

```
virtual BOOL OnSetData(
    LPFORMATETC lpFormatEtc,
    LPSTGMEDIUM lpStgMedium,
    BOOL bRelease);
```

### <a name="parameters"></a>参数

*lpFormatEtc*<br/>
指向指定数据格式的[FORMATETC](/windows/win32/api/objidl/ns-objidl-formatetc)结构的指针。

*lpStg 中*<br/>
指向数据所在的[STGMEDIUM](/windows/win32/api/objidl/ns-objidl-ustgmedium~r1)结构的指针。

*b释放*<br/>
如果控件应释放存储介质，则为 TRUE;如果控件不应释放存储介质，则 FALSE。

### <a name="return-value"></a>返回值

如果成功，则不为 0；否则为 0。

### <a name="remarks"></a>备注

如果数据采用持久属性集格式，则默认实现将相应地修改控件的状态。 否则，默认实现不执行任何操作。 如果*bRelease*为 TRUE，则`ReleaseStgMedium`调用 ;否则，不。

重写此函数以将控件的数据替换为指定的数据。

有关详细信息，请参阅 Windows `FORMATETC` SDK`STGMEDIUM`中的 和 结构。

## <a name="colecontrolonsetextent"></a><a name="onsetextent"></a>COle 控制：在设置范围

当需要更改控件的范围时，由于调用[IOleObject：：：set 范围](/windows/win32/api/oleidl/nf-oleidl-ioleobject-setextent)，则由框架调用。

```
virtual BOOL OnSetExtent(LPSIZEL lpSizeL);
```

### <a name="parameters"></a>参数

*lpSizeL*<br/>
指向使用长整`SIZEL`数表示控件的宽度和高度的结构的指针，以 HIMETRIC 单位表示。

### <a name="return-value"></a>返回值

如果接受大小更改，则非零;否则 0。

### <a name="remarks"></a>备注

默认实现处理控件范围的调整大小。 如果控件处于就地活动状态，则对容器的`OnPosRectChanged`调用。

重写此函数以更改控件的默认大小调整。

## <a name="colecontrolonsetobjectrects"></a><a name="onsetobjectrects"></a>COle 控制：OnSetObjectrects

由框架调用以实现对[IOleInPlace 对象的调用：：设置对象重新对象](/windows/win32/api/oleidl/nf-oleidl-ioleinplaceobject-setobjectrects)。

```
virtual BOOL OnSetObjectRects(
    LPCRECT lpRectPos,
    LPCRECT lpRectClip);
```

### <a name="parameters"></a>参数

*lpRectPos*<br/>
指向指示控件相对于`RECT`容器的新位置和大小的结构的指针。

*lprectClip*<br/>
指向指示要剪切`RECT`控件的矩形区域的结构的指针。

### <a name="return-value"></a>返回值

接受重新定位时非零;否则 0。

### <a name="remarks"></a>备注

默认实现自动处理控件窗口的重新定位和调整大小，并返回 TRUE。

重写此函数以更改此函数的默认行为。

## <a name="colecontrolonshowtoolbars"></a><a name="onshowtoolbars"></a>COleControl：：在显示工具栏上

当控件已激活 UI 时，由框架调用。

```
virtual void OnShowToolBars();
```

### <a name="remarks"></a>备注

默认实现不执行任何操作。

## <a name="colecontrolontextchanged"></a><a name="ontextchanged"></a>COle 控制：在文本上更改

当股票标题或文本属性值发生更改时，由框架调用。

```
virtual void OnTextChanged();
```

### <a name="remarks"></a>备注

默认实现调用`InvalidateControl`。

如果要在此属性更改后通知，则重写此函数。

## <a name="colecontrolonwindowlessmessage"></a><a name="onwindowlessmessage"></a>COleControl：无窗口消息

框架响应容器`IOleInPlaceObjectWindowless::OnWindowMessage`请求调用。

```
virtual BOOL OnWindowlessMessage(
    UINT msg,
    WPARAM wParam,
    LPARAM lParam,
    LRESULT* plResult);
```

### <a name="parameters"></a>参数

*味精*<br/>
由 Windows 传递的消息标识符。

*wParam*<br/>
通过 Windows。 指定其他特定于消息的信息。 此参数的内容取决于*msg*参数的值。

*lParam*<br/>
通过 Windows。 指定其他特定于消息的信息。 此参数的内容取决于*msg*参数的值。

*plResult*<br/>
窗口结果代码。 指定消息处理的结果，并取决于发送的消息。

### <a name="return-value"></a>返回值

如果成功，则不为 0；否则为 0。

### <a name="remarks"></a>备注

处理无窗口控件的窗口消息。 `COleControl`应`OnWindowlessMessage`用于鼠标消息和键盘消息以外的窗口消息。 `COleControl`提供[SetCapture](#setcapture)和[SetFocus，](#setfocus)专门用于获取无窗口 OLE 对象的鼠标捕获和键盘焦点。

由于无窗口对象没有窗口，因此它们需要一种机制来让容器向它们发送消息。 无窗口 OLE 对象通过`OnWindowMessage``IOleInPlaceObjectWindowless`接口上的方法（用于无窗口支持的[IOleInPlace 对象的](/windows/win32/api/oleidl/nn-oleidl-ioleinplaceobject)扩展），从其容器获取消息。 `OnWindowMessage`不采用参数`HWND`。

## <a name="colecontrolparenttoclient"></a><a name="parenttoclient"></a>COleControl：:P客户

将*pPoint*的坐标转换为客户端坐标。

```
virtual UINT ParentToClient(
    LPCRECT lprcBounds,
    LPPOINT pPoint,
    BOOL bHitTest = FALSE) const;
```

### <a name="parameters"></a>参数

*lprcBounds*<br/>
指向容器内 OLE 控件的边界。 不是工作区，而是整个控件的区域，包括边框和滚动条。

*pPoint*<br/>
指向父（容器）点的指针要转换为控件的工作区的坐标。

*bHitTest*<br/>
指定是否在点上执行命中测试。

### <a name="return-value"></a>返回值

如果*bHitTest*是 FALSE，则返回 HTNOWHERE。 如果*bHitTest*为 TRUE，则返回父（容器）点降落在 OLE 控件的工作区的位置，并且是以下鼠标命中测试值之一：

- HTBORDER 在没有大小调整边框的窗口的边框中。

- HTBOTTOM 在窗口的下水平边框中。

- 在窗口边框的左下角。

- 在窗口边框的右下角。

- 在标题栏区域中。

- 在客户端区域中。

- HTERROR 在屏幕背景或窗口之间的分界线上（与 HTNOWHERE 相同，只不过`DefWndProc`Windows 功能发出系统蜂鸣音以指示错误）。

- 在大小框中。

- HTHSCROLL 在水平滚动条中。

- 在窗口的左侧边框中。

- HTMAXBUTTON 在最大化按钮中。

- 在菜单区域中。

- 在最小化按钮中。

- 在屏幕背景或窗口之间的分界线上。

- 在最小化按钮中。

- 在窗口的右侧边框中。

- 在大小框中（与 HTGROWBOX 相同）。

- 在"控制"菜单中或在子窗口中的"关闭"按钮中。

- HTTOP 在窗口的上水平边框中。

- 在窗口边框的左上角。

- 在窗口边框的右上角。

- HTOPAQUE 当前由另一个窗口覆盖的窗口。

- 垂直滚动栏中的 HTVSCROLL。

- 在最大化按钮中使用 HTZOOM。

### <a name="remarks"></a>备注

在输入*pPoint*上相对于父端的原点（容器的左上角）。 在输出*pPoint*上相对于 OLE 控件的工作区的原点（控件的工作区的左上角）。

## <a name="colecontrolpostmodaldialog"></a><a name="postmodaldialog"></a>COleControl：:P模式对话

通知容器模式对话框已关闭。

```cpp
void PostModalDialog(HWND hWndParent = NULL);
```

### <a name="parameters"></a>参数

*hWnd 父母*<br/>
处理模式对话框的父窗口。

### <a name="remarks"></a>备注

显示任何模式对话框后调用此函数。 必须调用此函数，以便容器可以启用 由`PreModalDialog`禁用的任何顶级窗口。 此函数应与 调用`PreModalDialog`配对。

## <a name="colecontrolpremodaldialog"></a><a name="premodaldialog"></a>COleControl：:P重新模式对话

通知容器即将显示模式对话框。

```cpp
void PreModalDialog(HWND hWndParent = NULL);
```

### <a name="parameters"></a>参数

*hWnd 父母*<br/>
处理模式对话框的父窗口。

### <a name="remarks"></a>备注

在显示任何模式对话框之前调用此函数。 您必须调用此函数，以便容器可以禁用其所有顶级窗口。 显示模式对话框后，必须调用`PostModalDialog`。

## <a name="colecontrolrecreatecontrolwindow"></a><a name="recreatecontrolwindow"></a>COle 控制：：重新创建控制窗口

销毁并重新创建控件的窗口。

```cpp
void RecreateControlWindow();
```

### <a name="remarks"></a>备注

如果需要更改窗口的样式位，则可能需要这样做。

## <a name="colecontrolrefresh"></a><a name="refresh"></a>COle 控制：刷新

强制重新绘制 OLE 控件。

```cpp
void Refresh();
```

### <a name="remarks"></a>备注

`COleControl`基类支持此功能作为股票方法（称为刷新）。 这允许 OLE 控件的用户在特定时间重新绘制控件。 有关此方法的详细信息，请参阅文章[ActiveX 控件：方法](../../mfc/mfc-activex-controls-methods.md)。

## <a name="colecontrolreleasecapture"></a><a name="releasecapture"></a>COle 控制：：发布捕获

释放鼠标捕获。

```
BOOL ReleaseCapture();
```

### <a name="return-value"></a>返回值

如果成功，则不为 0；否则为 0。

### <a name="remarks"></a>备注

如果控件当前具有鼠标捕获，则释放捕获。 否则，此函数不起作用。

## <a name="colecontrolreleasedc"></a><a name="releasedc"></a>COle 控制：释放DC

释放无窗口控件容器的显示设备上下文，释放设备上下文供其他应用程序使用。

```
int ReleaseDC(CDC* pDC);
```

### <a name="parameters"></a>参数

*pDC*<br/>
标识要发布的容器设备上下文。

### <a name="return-value"></a>返回值

如果成功，则不为 0；否则为 0。

### <a name="remarks"></a>备注

应用程序必须调用`ReleaseDC` [GetDC](#getdc)的每个调用。

## <a name="colecontrolreparentcontrolwindow"></a><a name="reparentcontrolwindow"></a>COle 控制：：重父控制窗口

设置控件的父级。

```
virtual void ReparentControlWindow(
    HWND hWndOuter,
    HWND hWndParent);
```

### <a name="parameters"></a>参数

*hWndouter*<br/>
控制窗口的句柄。

*hWnd 父母*<br/>
新父窗口的句柄。

### <a name="remarks"></a>备注

调用此函数以重置控件窗口的父级。

## <a name="colecontrolresetstockprops"></a><a name="resetstockprops"></a>COle 控制：：重置库存

将`COleControl`股票属性的状态初始化到其默认值。

```cpp
void ResetStockProps();
```

### <a name="remarks"></a>备注

属性包括：外观、背面颜色、边框样式、标题、启用、字体、前颜色、hwnd 和文本。 有关股票属性的说明，请参阅[ActiveX 控件：添加股票属性](../../mfc/mfc-activex-controls-adding-stock-properties.md)。

可以使用`ResetStockProps`和`ResetVersion`可以提高控件的二进制初始化性能。 `COleControl::OnResetState` 请参阅以下示例。 有关优化初始化的详细信息，请参阅[ActiveX 控件：优化](../../mfc/mfc-activex-controls-optimization.md)。

### <a name="example"></a>示例

[!code-cpp[NVC_MFCAxCtl#7](../../mfc/reference/codesnippet/cpp/colecontrol-class_8.cpp)]

## <a name="colecontrolresetversion"></a><a name="resetversion"></a>COle 控制：重置版本

将版本号初始化为指定值。

```cpp
void ResetVersion(DWORD dwVersionDefault);
```

### <a name="parameters"></a>参数

*dwVersionDefault*<br/>
要分配给控件的版本号。

### <a name="remarks"></a>备注

可以使用`ResetVersion`和`ResetStockProps`可以提高控件的二进制初始化性能。 `COleControl::OnResetState` 请参阅[ResetStockProps](#resetstockprops)上的示例。 有关优化初始化的详细信息，请参阅[ActiveX 控件：优化](../../mfc/mfc-activex-controls-optimization.md)。

## <a name="colecontrolscrollwindow"></a><a name="scrollwindow"></a>COle 控制：滚动窗口

允许无窗口 OLE 对象在屏幕上滚动其就地活动图像中的区域。

```cpp
void ScrollWindow(
    int xAmount,
    int yAmount,
    LPCRECT lpRect = NULL,
    LPCRECT lpClipRect = NULL);
```

### <a name="parameters"></a>参数

*x数量*<br/>
指定水平滚动的数量（以设备单位为单位）。 此参数必须是向左滚动的负值。

*y 数量*<br/>
指定垂直滚动的数量（以设备单位为单位）。 此参数必须是负值才能向上滚动。

*lpRect*<br/>
指向[CRect](../../atl-mfc-shared/reference/crect-class.md)对象或 RECT 结构，该结构指定 OLE 对象要滚动的工作区部分，位于包含窗口的客户端坐标中。 如果*lpRect*为 NULL，则滚动整个 OLE 对象的工作区。

*lpClipRect*<br/>
指向指定`CRect`要剪辑到`RECT`的矩形的对象或结构。 仅滚动矩形内的像素。 矩形外部的位不受影响，即使它们位于*lpRect*矩形中也是如此。 如果*lpClipRect*为 NULL，则滚动矩形上不执行任何剪辑。

## <a name="colecontrolselectfontobject"></a><a name="selectfontobject"></a>COle 控制：选择字体对象

在设备上下文中选择字体。

```
CFont* SelectFontObject(
    CDC* pDC,
    CFontHolder& fontHolder);
```

### <a name="parameters"></a>参数

*pDC*<br/>
指向设备上下文对象的指针。

*字体持有人*<br/>
引用表示要选择的字体的[CFontHolder](../../mfc/reference/cfontholder-class.md)对象。

### <a name="return-value"></a>返回值

指向以前选定的字体的指针。 当调用方完成使用*fontHolder*的所有绘图操作后，应重新选择以前选择的字体，将其作为参数传递给[CDC：：选择对象](../../mfc/reference/cdc-class.md#selectobject)。

## <a name="colecontrolselectstockfont"></a><a name="selectstockfont"></a>COleControl：选择库存字体

在设备上下文中选择"库存字体"属性。

```
CFont* SelectStockFont(CDC* pDC);
```

### <a name="parameters"></a>参数

*pDC*<br/>
将在其中选择字体的设备上下文。

### <a name="return-value"></a>返回值

指向以前选定的`CFont`对象的指针。 您应该使用[CDC：：选择Object，](../../mfc/reference/cdc-class.md#selectobject)在完成后选择此字体回设备上下文中。

## <a name="colecontrolserializeextent"></a><a name="serializeextent"></a>COle 控制：序列化范围

序列化或初始化分配给控件的显示空间的状态。

```cpp
void SerializeExtent(CArchive& ar);
```

### <a name="parameters"></a>参数

*ar*<br/>
要`CArchive`序列化到或从中序列化的对象。

### <a name="remarks"></a>备注

可以使用`SerializeExtent`和`SerializeStockProps``SerializeVersion`可以提高控件的二进制持久性性能`COleControl::Serialize`， 请参阅以下示例。 有关优化初始化的详细信息，请参阅[ActiveX 控件：优化](../../mfc/mfc-activex-controls-optimization.md)。

### <a name="example"></a>示例

[!code-cpp[NVC_MFCAxCtl#8](../../mfc/reference/codesnippet/cpp/colecontrol-class_9.cpp)]

## <a name="colecontrolserializestockprops"></a><a name="serializestockprops"></a>COle 控制：：序列化库存

序列化或初始化`COleControl`股票属性的状态：外观、背面颜色、边框样式、标题、已启用、字体、前颜色和文本。

```cpp
void SerializeStockProps(CArchive& ar);
```

### <a name="parameters"></a>参数

*ar*<br/>
要`CArchive`序列化到或从中序列化的对象。

### <a name="remarks"></a>备注

有关股票属性的说明，请参阅[ActiveX 控件：添加股票属性](../../mfc/mfc-activex-controls-adding-stock-properties.md)。

可以使用`SerializeStockProps`和`SerializeExtent``SerializeVersion`可以提高控件的二进制持久性性能`COleControl::Serialize`， 例如，请参阅[序列化范围](#serializeextent)中的代码。 有关优化初始化的详细信息，请参阅[ActiveX 控件：优化](../../mfc/mfc-activex-controls-optimization.md)。

## <a name="colecontrolserializeversion"></a><a name="serializeversion"></a>COle 控制：序列化版本

序列化或初始化控件的版本信息的状态。

```
DWORD SerializeVersion(
    CArchive& ar,
    DWORD dwVersionDefault,
    BOOL bConvert = TRUE);
```

### <a name="parameters"></a>参数

*ar*<br/>
要`CArchive`序列化到或从中序列化的对象。

*dwVersionDefault*<br/>
控件的当前版本号。

*b转换*<br/>
指示在保存持久性数据时是否应转换为最新格式，还是以加载时的相同格式进行维护。

### <a name="return-value"></a>返回值

控件的版本号。 如果正在加载指定的存档，则`SerializeVersion`返回从该存档加载的版本。 否则，它将返回当前加载的版本。

### <a name="remarks"></a>备注

可以使用`SerializeVersion`和`SerializeExtent``SerializeStockProps`可以提高控件的二进制持久性性能`COleControl::Serialize`， 例如，请参阅[序列化范围](#serializeextent)中的代码。 有关优化初始化的详细信息，请参阅[ActiveX 控件：优化](../../mfc/mfc-activex-controls-optimization.md)。

## <a name="colecontrolsetappearance"></a><a name="setappearance"></a>COle 控制：：设置外观

设置控件的库存外观属性值。

```cpp
void SetAppearance (short sAppearance);
```

### <a name="parameters"></a>参数

*s外观*<br/>
用于**short**控件外观的简短（VT_I2）值。 值为零将控件的外观设置为平面，值 1 将控件的外观设置为 3D。

### <a name="remarks"></a>备注

有关股票属性的更多，请参阅[ActiveX 控件：属性](../../mfc/mfc-activex-controls-properties.md)。

## <a name="colecontrolsetbackcolor"></a><a name="setbackcolor"></a>COle 控制：：设置回颜色

设置控件的库存回颜色属性值。

```cpp
void SetBackColor(OLE_COLOR dwBackColor);
```

### <a name="parameters"></a>参数

*dwBackColor*<br/>
用于控件的背景绘制的OLE_COLOR值。

### <a name="remarks"></a>备注

有关使用此属性和其他相关属性的详细信息，请参阅[文章 ActiveX 控件：属性](../../mfc/mfc-activex-controls-properties.md)。

## <a name="colecontrolsetborderstyle"></a><a name="setborderstyle"></a>COle 控制：设置边框样式

设置控件的库存 BorderStyle 属性值。

```cpp
void SetBorderStyle(short sBorderStyle);
```

### <a name="parameters"></a>参数

*s边框样式*<br/>
控件的新边框样式;0 表示没有边框，1 表示正常边框。

### <a name="remarks"></a>备注

然后，将重新创建和`OnBorderStyleChanged`调用控制窗口。

## <a name="colecontrolsetcapture"></a><a name="setcapture"></a>COle 控制：设置捕获

使控件的容器窗口代表控件获取鼠标捕获。

```
CWnd* SetCapture();
```

### <a name="return-value"></a>返回值

指向以前接收鼠标`CWnd`输入的窗口对象的指针。

### <a name="remarks"></a>备注

如果控件被激活且无窗口，则此函数会导致控件的容器窗口代表控件获取鼠标捕获。 否则，此函数会导致控件本身获取鼠标捕获（与`CWnd::SetCapture`相同）。

## <a name="colecontrolsetcontrolsize"></a><a name="setcontrolsize"></a>COle 控制：设置控制大小

设置 OLE 控制窗口的大小，并通知容器控件站点正在更改。

```
BOOL SetControlSize(int cx, int cy);
```

### <a name="parameters"></a>参数

*残雪*<br/>
指定控件的新宽度（以像素为单位）。

*cy*<br/>
指定控件的新高度（以像素为单位）。

### <a name="return-value"></a>返回值

如果调用成功，则非零;否则 0。

### <a name="remarks"></a>备注

此函数不应在控件的构造函数中使用。

请注意，控件窗口的所有坐标都相对于控件的左上角。

## <a name="colecontrolsetenabled"></a><a name="setenabled"></a>COle 控制：已启用

设置控件的"已启用"属性值。

```cpp
void SetEnabled(BOOL bEnabled);
```

### <a name="parameters"></a>参数

*b 启用*<br/>
如果要启用控件，则为 TRUE;如果要启用该控件，则为 TRUE。否则 FALSE。

### <a name="remarks"></a>备注

设置此属性后，`OnEnabledChange`将调用。

## <a name="colecontrolsetfocus"></a><a name="setfocus"></a>COle 控制：设置焦点

使控件的容器窗口以控件的名义占用输入焦点。

```
CWnd* SetFocus();
```

### <a name="return-value"></a>返回值

指向以前具有输入`CWnd`焦点的窗口对象的指针，如果没有这样的窗口，则指向 NULL。

### <a name="remarks"></a>备注

如果控件被激活且无窗口，则此函数会导致控件的容器窗口以控件的名义获取输入焦点。 输入焦点将键盘输入定向到容器的窗口，容器将所有后续的键盘消息调度到调用`SetFocus`的 OLE 对象。 以前具有输入焦点的任何窗口都丢失它。

如果控件不是无窗口的，则此函数会导致控件本身占用输入焦点（与`CWnd::SetFocus`相同）。

## <a name="colecontrolsetfont"></a><a name="setfont"></a>COle 控制：：设置字体

设置控件的库存字体属性。

```cpp
void SetFont(LPFONTDISP pFontDisp);
```

### <a name="parameters"></a>参数

*pFontDisp*<br/>
指向字体调度界面的指针。

## <a name="colecontrolsetforecolor"></a><a name="setforecolor"></a>COleControl：设置福彩

设置控件的库存 ForeColor 属性值。

```cpp
void SetForeColor(OLE_COLOR dwForeColor);
```

### <a name="parameters"></a>参数

*dwForeColor*<br/>
用于控件的前景绘图的OLE_COLOR值。

### <a name="remarks"></a>备注

有关使用此属性和其他相关属性的详细信息，请参阅[文章 ActiveX 控件：属性](../../mfc/mfc-activex-controls-properties.md)。

## <a name="colecontrolsetinitialdataformats"></a><a name="setinitialdataformats"></a>COleControl：设置初始数据格式

由框架调用以初始化控件支持的数据格式列表。

```
virtual void SetInitialDataFormats();
```

### <a name="remarks"></a>备注

默认实现指定两种格式：CF_METAFILEPICT 和持久属性集。

## <a name="colecontrolsetinitialsize"></a><a name="setinitialsize"></a>COle 控制：设置初始大小

设置首次显示在容器中的 OLE 控件的大小。

```cpp
void SetInitialSize(
    int cx,
    int cy);
```

### <a name="parameters"></a>参数

*残雪*<br/>
OLE 控件的初始宽度（以像素为单位）。

*cy*<br/>
OLE 控件的初始高度（以像素为单位）。

### <a name="remarks"></a>备注

在构造函数中调用此函数以设置控件的初始大小。 初始大小以设备单位或像素为单位进行测量。 建议在控件的构造函数中进行此调用。

## <a name="colecontrolsetmodifiedflag"></a><a name="setmodifiedflag"></a>COle 控制：设置已修改的标记

更改控件的已修改状态。

```cpp
void SetModifiedFlag(BOOL bModified = TRUE);
```

### <a name="parameters"></a>参数

*b 修改*<br/>
控件已修改标志的新值。 TRUE 表示控件的状态已被修改;FALSE 表示控件的状态刚刚保存。

### <a name="remarks"></a>备注

每当发生会影响控件的持久状态的更改时，请调用此函数。 例如，如果持久属性的值发生更改，请用 b 修改*bModified***TRUE**调用此函数。

## <a name="colecontrolsetnotpermitted"></a><a name="setnotpermitted"></a>COle 控制：设置不允许

指示编辑请求失败。

```cpp
void SetNotPermitted();
```

### <a name="remarks"></a>备注

发生故障时`BoundPropertyRequestEdit`调用此函数。 此函数将引发类型`COleDispScodeException`异常，以指示不允许设置操作。

## <a name="colecontrolsetnotsupported"></a><a name="setnotsupported"></a>COle 控制：设置不支持

防止用户修改控件的属性值。

```cpp
void SetNotSupported();
```

### <a name="remarks"></a>备注

调用此函数以代替不支持控件用户修改属性值的任何属性的 Set 函数。 例如，一个属性是只读的。

## <a name="colecontrolsetrectincontainer"></a><a name="setrectincontainer"></a>COle 控制：setrectin 容器

设置控件矩形相对于容器的坐标，以设备单位表示。

```
BOOL SetRectInContainer(LPCRECT lpRect);
```

### <a name="parameters"></a>参数

*lpRect*<br/>
指向包含控件相对于容器的新坐标的矩形的指针。

### <a name="return-value"></a>返回值

如果调用成功，则非零;否则 0。

### <a name="remarks"></a>备注

如果控件处于打开状态，则调整控件的大小;如果控件处于打开状态，则调整控件的大小。否则将调用容器的功能`OnPosRectChanged`。

## <a name="colecontrolsettext"></a><a name="settext"></a>COle 控制：设置文本

设置控件的库存标题或文本属性的值。

```cpp
void SetText(LPCTSTR pszText);
```

### <a name="parameters"></a>参数

*pszText*<br/>
指向字符串的指针。

### <a name="remarks"></a>备注

请注意，股票标题和文本属性都映射到相同的值。 这意味着对任一属性所做的任何更改都将自动更改这两个属性。 通常，控件应支持股票标题或文本属性，但不能同时支持这两者。

## <a name="colecontrolthrowerror"></a><a name="throwerror"></a>COle 控制：：投掷错误

指示控件中出现错误。

```cpp
void ThrowError(
    SCODE sc,
    UINT nDescriptionID,
    UINT nHelpID = -1);

void ThrowError(
    SCODE sc,
    LPCTSTR pszDescription = NULL,
    UINT nHelpID = 0);
```

### <a name="parameters"></a>参数

*Sc*<br/>
要报告的状态代码值。 有关可能代码的完整列表，请参阅["ActiveX 控件：高级主题"一](../../mfc/mfc-activex-controls-advanced-topics.md)文。

*n 描述ID*<br/>
要报告的异常的字符串资源 ID。

*nHelpID*<br/>
要报告的主题的帮助 ID。

*psz描述*<br/>
包含要报告的异常的解释的字符串。

### <a name="remarks"></a>备注

此函数应仅从 OLE 属性的 Get 或 Set 函数中调用，或实现 OLE 自动化方法。 如果需要发出其他时间发生的错误信号，则应触发库存错误事件。

## <a name="colecontroltransformcoords"></a><a name="transformcoords"></a>COle 控制：转换库德

变换 HIMETRIC 单位和容器的本机单位之间的坐标值。

```cpp
void TransformCoords(
    POINTL* lpptlHimetric,
    POINTF* lpptfContainer,
    DWORD flags);
```

### <a name="parameters"></a>参数

*lpptlHimetric*<br/>
指向包含`POINTL`HIMETRIC 单位坐标的结构的指针。

*lpptf 容器*<br/>
指向`POINTF`容器单位大小中包含坐标的结构的指针。

*flag*<br/>
以下值的组合：

- XFORMCOORDS_POSITION容器中的位置。

- XFORMCOORDS_SIZE 容器中的大小。

- XFORMCOORDS_HIMETRICTOCONTAINER将 HIMETRIC 单元转换为容器的单位。

- XFORMCOORDS_CONTAINERTOHIMETRIC将容器的单位转换为 HIMETRIC 单位。

### <a name="remarks"></a>备注

前两个标志（XFORMCOORDS_POSITION和XFORMCOORDS_SIZE）指示坐标是否应被视为位置或大小。 其余两个标志指示转换方向。

## <a name="colecontroltranslatecolor"></a><a name="translatecolor"></a>COleControl：翻译颜色

将颜色值从OLE_COLOR数据类型转换为[COLORREF](/windows/win32/gdi/colorref)数据类型。

```
COLORREF TranslateColor(
    OLE_COLOR clrColor,
    HPALETTE hpal = NULL);
```

### <a name="parameters"></a>参数

*clrColor*<br/>
OLE_COLOR数据类型。 有关详细信息，请参阅 Windows [OleTranslateColor](/windows/win32/api/olectl/nf-olectl-oletranslatecolor)功能。

*赫帕尔*<br/>
可选调色板的句柄;可以是 NULL。

### <a name="return-value"></a>返回值

RGB（红色、绿色、蓝色）32 位颜色值，用于定义最接近设备可以表示的*clrColor*值的纯色。

### <a name="remarks"></a>备注

此功能可用于将库存 ForeColor 和 BackColor 属性转换为[CDC](../../mfc/reference/cdc-class.md)成员函数使用的 COLORREF 类型。

## <a name="colecontrolwillambientsbevalidduringload"></a><a name="willambientsbevalidduringload"></a>COle 控制：在加载期间，环境将有效

确定控件是否应使用环境属性的值作为默认值，当它随后从其持久状态加载时。

```
BOOL WillAmbientsBeValidDuringLoad();
```

### <a name="return-value"></a>返回值

非零表示环境属性将有效;因此，表示环境属性将有效。否则环境属性将无效。

### <a name="remarks"></a>备注

在某些容器中，控件在初始调用`COleControl::DoPropExchange`重写 期间可能无法访问其环境属性。 如果容器调用[IPersistStreamInit：：加载](/windows/win32/api/ocidl/nf-ocidl-ipersiststreaminit-load)或[IPersistStorage：：在](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load)调用[IOleObject：：setClientSite](/windows/win32/api/oleidl/nf-oleidl-ioleobject-setclientsite)之前加载（即，如果它不符合OLEMISC_SETCLIENTSITEFIRST状态位），则属于这种情况。

## <a name="colecontrolwindowproc"></a><a name="windowproc"></a>COle 控制：：窗口 Proc

为`COleControl`对象提供 Windows 过程。

```
virtual LRESULT WindowProc(
    UINT message,
    WPARAM wParam,
    LPARAM lParam);
```

### <a name="parameters"></a>参数

*message*<br/>
指定要处理的 Windows 消息。

*wParam*<br/>
提供用于处理消息的其他信息。 参数值取决于消息。

*lParam*<br/>
提供用于处理消息的其他信息。 参数值取决于消息。

### <a name="return-value"></a>返回值

调度消息的返回值。

### <a name="remarks"></a>备注

调用此函数通过控件的消息映射调度特定消息。

## <a name="see-also"></a>请参阅

[MFC 样品 CIRC3](../../overview/visual-cpp-samples.md)<br/>
[MFC 样品测试](../../overview/visual-cpp-samples.md)<br/>
[COle属性页类](../../mfc/reference/colepropertypage-class.md)<br/>
[CWnd 类](../../mfc/reference/cwnd-class.md)<br/>
[层次结构图表](../../mfc/hierarchy-chart.md)<br/>
[CFontHolder 类](../../mfc/reference/cfontholder-class.md)<br/>
[CPictureHolder 类](../../mfc/reference/cpictureholder-class.md)<br/>
