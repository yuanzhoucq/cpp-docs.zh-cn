---
title: CRowset 类
ms.date: 11/04/2016
f1_keywords:
- ATL.CRowset<TAccessor>
- CRowset
- ATL::CRowset
- ATL::CRowset<TAccessor>
- ATL.CRowset
- CRowset<TAccessor>.AddRefRows
- CRowset.AddRefRows
- ATL.CRowset.AddRefRows
- AddRefRows
- CRowset::AddRefRows
- CRowset<TAccessor>::AddRefRows
- ATL::CRowset::AddRefRows
- ATL.CRowset<TAccessor>.AddRefRows
- ATL::CRowset<TAccessor>::AddRefRows
- CRowset::Close
- ATL.CRowset.Close
- CRowset<TAccessor>::Close
- CRowset<TAccessor>.Close
- ATL.CRowset<TAccessor>.Close
- ATL::CRowset::Close
- ATL::CRowset<TAccessor>::Close
- CRowset.Close
- CRowset<TAccessor>.Compare
- CRowset<TAccessor>::Compare
- ATL.CRowset<TAccessor>.Compare
- ATL::CRowset<TAccessor>::Compare
- CRowset.Compare
- ATL::CRowset::Compare
- ATL.CRowset.Compare
- CRowset::Compare
- CRowset<TAccessor>::CRowset
- CRowset.CRowset
- ATL::CRowset::CRowset
- ATL::CRowset<TAccessor>::CRowset
- ATL.CRowset.CRowset
- CRowset<TAccessor>.CRowset
- CRowset::CRowset
- ATL.CRowset<TAccessor>.CRowset
- ATL::CRowset::Delete
- CRowset.Delete
- CRowset::Delete
- ATL.CRowset.Delete
- ATL::CRowset<TAccessor>::Delete
- CRowset<TAccessor>.Delete
- CRowset<TAccessor>::Delete
- ATL.CRowset<TAccessor>.Delete
- ATL.CRowset.FindNextRow
- CRowset<TAccessor>.FindNextRow
- ATL::CRowset::FindNextRow
- CRowset::FindNextRow
- CRowset<TAccessor>::FindNextRow
- CRowset.FindNextRow
- ATL.CRowset<TAccessor>.FindNextRow
- ATL::CRowset<TAccessor>::FindNextRow
- FindNextRow
- ATL::CRowset::GetApproximatePosition
- ATL::CRowset<TAccessor>::GetApproximatePosition
- CRowset.GetApproximatePosition
- CRowset::GetApproximatePosition
- GetApproximatePosition
- ATL.CRowset.GetApproximatePosition
- CRowset<TAccessor>::GetApproximatePosition
- CRowset<TAccessor>::GetData
- ATL::CRowset<TAccessor>::GetData
- ATL::CRowset::GetData
- ATL.CRowset<TAccessor>.GetData
- CRowset<TAccessor>.GetData
- CRowset::GetData
- CRowset.GetData
- ATL.CRowset.GetData
- CRowset<TAccessor>::GetDataHere
- CRowset<TAccessor>.GetDataHere
- CRowset.GetDataHere
- GetDataHere
- CRowset::GetDataHere
- ATL::CRowset::GetDataHere
- ATL::CRowset<TAccessor>::GetDataHere
- ATL.CRowset<TAccessor>.GetDataHere
- ATL.CRowset.GetDataHere
- ATL.CRowset<TAccessor>.GetOriginalData
- CRowset<TAccessor>::GetOriginalData
- ATL::CRowset<TAccessor>::GetOriginalData
- ATL.CRowset.GetOriginalData
- CRowset::GetOriginalData
- ATL::CRowset::GetOriginalData
- CRowset.GetOriginalData
- CRowset.GetRowStatus
- ATL.CRowset<TAccessor>.GetRowStatus
- ATL::CRowset<TAccessor>::GetRowStatus
- CRowset::GetRowStatus
- ATL::CRowset::GetRowStatus
- CRowset<TAccessor>::GetRowStatus
- ATL.CRowset.GetRowStatus
- CRowset<TAccessor>.GetRowStatus
- ATL.CRowset<TAccessor>.Insert
- CRowset.Insert
- CRowset<TAccessor>.Insert
- CRowset<TAccessor>::Insert
- ATL::CRowset<TAccessor>::Insert
- ATL.CRowset.Insert
- CRowset::Insert
- ATL::CRowset::Insert
- CRowset::IsSameRow
- CRowset.IsSameRow
- ATL::CRowset::IsSameRow
- ATL.CRowset.IsSameRow
- CRowset<TAccessor>::IsSameRow
- ATL.CRowset<TAccessor>.IsSameRow
- CRowset<TAccessor>.IsSameRow
- ATL::CRowset<TAccessor>::IsSameRow
- CRowset<TAccessor>::MoveFirst
- ATL::CRowset::MoveFirst
- CRowset<TAccessor>.MoveFirst
- CRowset::MoveFirst
- CRowset.MoveFirst
- ATL.CRowset.MoveFirst
- ATL.CRowset<TAccessor>.MoveFirst
- ATL::CRowset<TAccessor>::MoveFirst
- ATL::CRowset<TAccessor>::MoveLast
- CRowset<TAccessor>::MoveLast
- ATL.CRowset.MoveLast
- ATL::CRowset::MoveLast
- CRowset<TAccessor>.MoveLast
- CRowset::MoveLast
- ATL.CRowset<TAccessor>.MoveLast
- CRowset.MoveLast
- ATL.CRowset<TAccessor>.MoveNext
- ATL.CRowset.MoveNext
- ATL::CRowset<TAccessor>::MoveNext
- CRowset<TAccessor>.MoveNext
- CRowset.MoveNext
- CRowset<TAccessor>::MoveNext
- CRowset::MoveNext
- ATL::CRowset::MoveNext
- CRowset<TAccessor>.MovePrev
- CRowset.MovePrev
- CRowset::MovePrev
- ATL.CRowset.MovePrev
- ATL::CRowset<TAccessor>::MovePrev
- ATL::CRowset::MovePrev
- ATL.CRowset<TAccessor>.MovePrev
- CRowset<TAccessor>::MovePrev
- ATL::CRowset::MoveToBookmark
- ATL::CRowset<TAccessor>::MoveToBookmark
- ATL.CRowset.MoveToBookmark
- ATL.CRowset<TAccessor>.MoveToBookmark
- CRowset::MoveToBookmark
- CRowset.MoveToBookmark
- CRowset<TAccessor>::MoveToBookmark
- CRowset<TAccessor>::MoveToRatio
- CRowset::MoveToRatio
- CRowset<TAccessor>.MoveToRatio
- ATL.CRowset.MoveToRatio
- ATL::CRowset::MoveToRatio
- CRowset.MoveToRatio
- ATL.CRowset<TAccessor>.MoveToRatio
- ATL::CRowset<TAccessor>::MoveToRatio
- CRowset::ReleaseRows
- ATL::CRowset<TAccessor>::ReleaseRows
- CRowset<TAccessor>.ReleaseRows
- CRowset.ReleaseRows
- ATL.CRowset.ReleaseRows
- ATL.CRowset<TAccessor>.ReleaseRows
- CRowset<TAccessor>::ReleaseRows
- ATL::CRowset::ReleaseRows
- ATL.CRowset<TAccessor>.SetData
- ATL::CRowset::SetData
- CRowset<TAccessor>.SetData
- CRowset::SetData
- ATL.CRowset.SetData
- CRowset.SetData
- CRowset<TAccessor>::SetData
- ATL::CRowset<TAccessor>::SetData
- CRowset.Undo
- ATL::CRowset<TAccessor>::Undo
- CRowset<TAccessor>::Undo
- ATL.CRowset.Undo
- ATL.CRowset<TAccessor>.Undo
- CRowset<TAccessor>.Undo
- ATL::CRowset::Undo
- CRowset::Undo
- Undo
- CRowset.Update
- ATL.CRowset.Update
- ATL.CRowset<TAccessor>.Update
- ATL::CRowset<TAccessor>::Update
- CRowset<TAccessor>::Update
- CRowset::Update
- CRowset<TAccessor>.Update
- ATL::CRowset::Update
- CRowset::UpdateAll
- ATL.CRowset.UpdateAll
- CRowset<TAccessor>.UpdateAll
- ATL.CRowset<TAccessor>.UpdateAll
- UpdateAll
- CRowset.UpdateAl
- ATL::CRowset<TAccessor>::UpdateAll
- CRowset<TAccessor>::UpdateAll
- ATL::CRowset::UpdateAll
helpviewer_keywords:
- CRowset class
- AddRefRows method
- Close method
- Compare method
- CRowset class, constructor
- Delete method
- FindNextRow method
- GetApproximatePosition method
- GetData method [OLE DB]
- GetDataHere method
- GetOriginalData method
- GetRowStatus method
- Insert method
- IsSameRow method
- MoveFirst method
- MoveLast method
- MoveNext method
- MovePrev method
- MoveToBookmark method
- MoveToRatio method
- ReleaseRows method
- SetData method
- Undo method
- Update method
- UpdateAll method
ms.assetid: b0228a90-b8dd-47cc-b397-8d4c15c1e7f4
ms.openlocfilehash: e67e385a8ce0eb9a6b041d4a4f0d43e2db551c79
ms.sourcegitcommit: 857fa6b530224fa6c18675138043aba9aa0619fb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/24/2020
ms.locfileid: "80211284"
---
# <a name="crowset-class"></a>CRowset 类

封装一个 OLE DB 行集对象和多个相关接口，并为行集数据提供操作方法。

## <a name="syntax"></a>语法

```cpp
template <class TAccessor = CAccessorBase>
class CRowset
```

### <a name="parameters"></a>parameters

*TAccessor*<br/>
一个访问器类。 默认为 `CAccessorBase`。

## <a name="requirements"></a>要求

**标头:** atldbcli.h

## <a name="members"></a>成员

### <a name="methods"></a>方法

|||
|-|-|
|[AddRefRows](#addrefrows)|递增与当前行关联的引用计数。|
|[关闭](#close)|释放行和当前 `IRowset` 接口。|
|[比较](#compare)|使用[IRowsetLocate：： Compare](/previous-versions/windows/desktop/ms709539(v=vs.85))比较两个书签。|
|[CRowset](#crowset)|创建新的 `CRowset` 对象，并（可选）将其与作为参数提供的 `IRowset` 接口相关联。|
|[删除](#delete)|使用[IRowsetChange： DeleteRows](/previous-versions/windows/desktop/ms724362(v=vs.85))删除行集中的行。|
|[FindNextRow](#findnextrow)|查找指定书签后面的下一个匹配行。|
|[GetApproximatePosition](#getapproximateposition)|返回对应于书签的行的近似位置。|
|[GetData](#getdata)|从行的行集合副本中检索数据。|
|[GetDataHere](#getdatahere)|从指定的缓冲区中检索数据。|
|[GetOriginalData](#getoriginaldata)|检索最近从或传输到数据源的数据，忽略挂起的更改。|
|[GetRowStatus](#getrowstatus)|返回所有行的状态。|
|[插入](#insert)|使用[IRowsetChange： InsertRow](/previous-versions/windows/desktop/ms716921(v=vs.85))创建并插入新行。|
|[IsSameRow](#issamerow)|将指定行与当前行进行比较。|
|[MoveFirst](#movefirst)|将下一个提取位置重新定位到初始位置。|
|[MoveLast](#movelast)|移到最后一条记录。|
|[MoveNext](#movenext)|从下一个连续行或指定数目的位置（在下一行之后）提取数据。|
|[MovePrev](#moveprev)|移动到上一条记录。|
|[MoveToBookmark](#movetobookmark)|提取书签所标记的行，或从该书签指定偏移量处的行。|
|[MoveToRatio](#movetoratio)|从行集中的小数位置开始提取行。|
|[ReleaseRows](#releaserows)|调用[IRowset：： ReleaseRows](/previous-versions/windows/desktop/ms719771(v=vs.85))以释放当前的行句柄。|
|[SetData](#setdata)|使用[IRowsetChange： SetData](/previous-versions/windows/desktop/ms721232(v=vs.85))设置行的一列或多列中的数据值。|
|[撤消](#undo)|撤消自上次提取或[更新](../../data/oledb/crowset-update.md)以来对行所做的任何更改。|
|[Update](#update)|传输自上次提取或更新以来对当前行所做的所有挂起的更改。|
|[UpdateAll](#updateall)|传输自上次提取或更新以来对所有行所做的所有挂起的更改。|

## <a name="remarks"></a>备注

在 OLE DB 中，行集是程序用来设置和检索数据的对象。

此类不应实例化，而是作为模板参数传递到 `CTable` 或 `CCommand` （`CRowset` 为默认值）。

## <a name="crowsetaddrefrows"></a><a name="addrefrows"></a>CRowset：： AddRefRows

调用[IRowset：： AddRefRows](/previous-versions/windows/desktop/ms719619(v=vs.85))以递增（一）与当前行句柄关联的引用计数。

### <a name="syntax"></a>语法

```cpp
HRESULT AddRefRows() throw();
```

### <a name="return-value"></a>返回值

标准的 HRESULT。

### <a name="remarks"></a>备注

此方法会递增当前行句柄的引用数。 调用[ReleaseRows](../../data/oledb/crowset-releaserows.md)以减少计数。 Move 方法返回的行的引用计数为1。

## <a name="crowsetclose"></a><a name="close"></a>CRowset：： Close

释放行和当前的[IRowset](/previous-versions/windows/desktop/ms720986(v=vs.85))接口。

### <a name="syntax"></a>语法

```cpp
void Close() throw();
```

### <a name="remarks"></a>备注

此方法释放行集合中当前包含的所有行。

## <a name="crowsetcompare"></a><a name="compare"></a>CRowset：： Compare

使用[IRowsetLocate：： Compare](/previous-versions/windows/desktop/ms709539(v=vs.85))比较两个书签。

### <a name="syntax"></a>语法

```cpp
HRESULT Compare(const CBookmarkBase& bookmark1,
   const CBookmarkBase& bookmark2,
   DBCOMPARE* pComparison) const throw();
```

#### <a name="parameters"></a>parameters

*Bookmark1*<br/>
中要比较的第一个书签。

*Bookmark2*<br/>
中要比较的第二个书签。

*pComparison*<br/>
弄指向比较结果的指针。

### <a name="return-value"></a>返回值

标准的 HRESULT。

### <a name="remarks"></a>备注

此方法需要 `IRowsetLocate`的可选接口，该接口在所有提供程序上可能不受支持;如果是这种情况，则该方法将返回 E_NOINTERFACE。 还必须在对包含行集的表或命令调用 `Open` 之前，将 `DBPROP_IRowsetLocate` 设置为 VARIANT_TRUE。

有关在使用者中使用书签的信息，请参阅[使用书签](../../data/oledb/using-bookmarks.md)。

## <a name="crowsetcrowset"></a><a name="crowset"></a>CRowset：： CRowset

创建新的 `CRowset` 对象，并（可选）将其与作为参数提供的[IRowset](/previous-versions/windows/desktop/ms720986(v=vs.85))接口相关联。

### <a name="syntax"></a>语法

```cpp
CRowset();

CRowset(IRowset* pRowset);
```

#### <a name="parameters"></a>parameters

*pRowset*<br/>
[in] 指向将与此类关联的 `IRowset` 接口的指针。

## <a name="crowsetdelete"></a><a name="delete"></a>CRowset：:D e)

调用[IRowsetChange：:D eleterows](/previous-versions/windows/desktop/ms724362(v=vs.85))删除行集中的当前行。

### <a name="syntax"></a>语法

```cpp
HRESULT Delete() const throw();
```

### <a name="return-value"></a>返回值

标准的 HRESULT。

## <a name="crowsetfindnextrow"></a><a name="findnextrow"></a>CRowset：： FindNextRow

查找指定书签后面的下一个匹配行。

### <a name="syntax"></a>语法

```cpp
HRESULT FindNextRow(DBCOMPAREOP op,
   BYTE* pData,
   DBTYPE wType,
   DBLENGTH nLength,
   BYTE bPrecision,
   BYTE bScale,
   BOOL bSkipCurrent = TRUE,
   CBookmarkBase* pBookmark = NULL) throw();
```

#### <a name="parameters"></a>parameters

*基金*<br/>
中用于比较行值的操作。 有关值，请参阅[IRowsetFind：： FindNextRow](/previous-versions/windows/desktop/ms723091(v=vs.85))。

*pData*<br/>
中指向要匹配的值的指针。

wType<br/>
中指示缓冲区的值部分的数据类型。 有关类型指示器的信息，请参阅 Windows SDK 中*OLE DB 程序员参考*中的[数据类型](/previous-versions/windows/desktop/ms723969(v=vs.85))。

*nLength*<br/>
中为数据值分配的使用者数据结构的长度（以字节为单位）。 有关详细信息，请参阅*OLE DB 程序员参考*中的[DBBINDING 结构](/previous-versions/windows/desktop/ms716845(v=vs.85))中 `cbMaxLen` 的说明。

bPrecision<br/>
中获取数据时使用的最大精度。 仅在 DBTYPE_NUMERIC *wType*时使用。 有关详细信息，请参阅*OLE DB 程序员参考*中[涉及 DBTYPE_NUMERIC 或 DBTYPE_DECIMAL 的转换](/previous-versions/windows/desktop/ms719714(v=vs.85))。

bScale<br/>
中获取数据时使用的小数位数。 仅当*wType*为 DBTYPE_NUMERIC 或 DBTYPE_DECIMAL 时使用。 有关详细信息，请参阅*OLE DB 程序员参考*中[涉及 DBTYPE_NUMERIC 或 DBTYPE_DECIMAL 的转换](/previous-versions/windows/desktop/ms719714(v=vs.85))。

*bSkipCurrent*<br/>
中书签中开始搜索的行数。

*pBookmark*<br/>
中要开始搜索的位置的书签。

### <a name="return-value"></a>返回值

标准的 HRESULT。

### <a name="remarks"></a>备注

此方法需要 `IRowsetFind`的可选接口，该接口在所有提供程序上可能不受支持;如果是这种情况，则该方法将返回 E_NOINTERFACE。 还必须在对包含行集的表或命令调用 `Open` 之前，将 `DBPROP_IRowsetFind` 设置为 VARIANT_TRUE。

有关在使用者中使用书签的信息，请参阅[使用书签](../../data/oledb/using-bookmarks.md)。

## <a name="crowsetgetapproximateposition"></a><a name="getapproximateposition"></a>CRowset：： GetApproximatePosition

返回对应于书签的行的近似位置。

### <a name="syntax"></a>语法

```cpp
HRESULT GetApproximatePosition(const CBookmarkBase* pBookmark,
   DBCOUNTITEM* pPosition,
   DBCOUNTITEM* pcRows) throw();
```

#### <a name="parameters"></a>parameters

*pBookmark*<br/>
中一个指针，指向用于标识要查找其位置的行的书签。 如果只需要行计数，则为 NULL。

*pPosition*<br/>
弄一个指针，指向 `GetApproximatePosition` 返回该行位置的位置。 如果不需要该位置，则为 NULL。

*pcRows*<br/>
弄指向 `GetApproximatePosition` 返回总行数的位置的指针。 如果不需要行计数，则为 NULL。

### <a name="return-value"></a>返回值

标准的 HRESULT。

### <a name="remarks"></a>备注

此方法需要 `IRowsetScroll`的可选接口，该接口在所有提供程序上可能不受支持;如果是这种情况，则该方法将返回 E_NOINTERFACE。 还必须在对包含行集的表或命令调用 `Open` 之前，将 `DBPROP_IRowsetScroll` 设置为 VARIANT_TRUE。

有关在使用者中使用书签的信息，请参阅[使用书签](../../data/oledb/using-bookmarks.md)。

## <a name="crowsetgetdata"></a><a name="getdata"></a>CRowset：：

从行的行集合副本中检索数据。

### <a name="syntax"></a>语法

```cpp
HRESULT GetData() throw();

HRESULT GetData(int nAccessor) throw();
```

#### <a name="parameters"></a>parameters

*nAccessor*<br/>
中要用于访问数据的访问器的（零偏移量）索引号。

### <a name="return-value"></a>返回值

标准的 HRESULT。

### <a name="remarks"></a>备注

如果指定的访问器不是[BEGIN_ACCESSOR](../../data/oledb/begin-accessor.md)中的 autoaccessor，请使用此方法通过传递访问器编号来显式获取数据。

## <a name="crowsetgetdatahere"></a><a name="getdatahere"></a>CRowset：： GetDataHere

检索当前行中的数据，并将其放入指定的缓冲区。

### <a name="syntax"></a>语法

```cpp
HRESULT GetDataHere(int nAccessor,
   void* pBuffer) throw();
```

#### <a name="parameters"></a>parameters

*nAccessor*<br/>
中要用于访问数据的访问器的索引号。

*pBuffer*<br/>
弄要在其中放置当前记录的数据的缓冲区。

### <a name="return-value"></a>返回值

标准的 HRESULT。

### <a name="remarks"></a>备注

有关如何使用此函数的示例，请参阅[MultiRead 示例](../../overview/visual-cpp-samples.md)。

## <a name="crowsetgetoriginaldata"></a><a name="getoriginaldata"></a>CRowset：： GetOriginalData

调用 `IRowsetUpdate::GetOriginalData` 检索最近从数据源提取或传输到数据源的数据。

### <a name="syntax"></a>语法

```cpp
HRESULT GetOriginalData() throw();
```

### <a name="return-value"></a>返回值

标准的 HRESULT。

### <a name="remarks"></a>备注

此方法检索最近从数据源提取或传输到数据源的数据;它不会基于挂起的更改检索值。

此方法需要 `IRowsetUpdate`的可选接口，该接口在所有提供程序上可能不受支持;如果是这种情况，则该方法将返回 E_NOINTERFACE。 还必须在对包含行集的表或命令调用 `Open` 之前，将 `DBPROP_IRowsetUpdate` 设置为 VARIANT_TRUE。

## <a name="crowsetgetrowstatus"></a><a name="getrowstatus"></a>CRowset：： GetRowStatus

返回所有行的状态。

### <a name="syntax"></a>语法

```cpp
HRESULT GetRowStatus(DBPENDINGSTATUS* pStatus) const throw();
```

#### <a name="parameters"></a>parameters

*pStatus*<br/>
弄指向 `GetRowStatus` 返回状态值的位置的指针。 请参阅 OLE DB 程序员参考中的 DBPENDINGSTATUS。

### <a name="return-value"></a>返回值

标准的 HRESULT。

### <a name="remarks"></a>备注

此方法需要 `IRowsetUpdate`的可选接口，该接口在所有提供程序上可能不受支持;如果是这种情况，则该方法将返回 E_NOINTERFACE。 还必须在对包含行集的表或命令调用 `Open` 之前，将 `DBPROP_IRowsetUpdate` 设置为 VARIANT_TRUE。

## <a name="crowsetinsert"></a><a name="insert"></a>CRowset：： Insert

使用访问器中的数据创建并初始化新行。

### <a name="syntax"></a>语法

```cpp
HRESULT Insert(int nAccessor = 0,
   bool bGetHRow = false) throw();
```

#### <a name="parameters"></a>parameters

*nAccessor*<br/>
中用于插入数据的访问器的数目。

*bGetHRow*<br/>
中指示是否检索插入行的句柄。

### <a name="return-value"></a>返回值

标准的 HRESULT。

### <a name="remarks"></a>备注

此方法需要 `IRowsetChange`的可选接口，该接口在所有提供程序上可能不受支持;如果是这种情况，则该方法将返回 E_NOINTERFACE。 还必须在对包含行集的表或命令调用 `Open` 之前，将 `DBPROP_IRowsetChange` 设置为 VARIANT_TRUE。

如果一列或多列不可写，则插入可能会失败。 修改光标映射以更正此问题。

### <a name="example"></a>示例

下面的示例演示如何通过行集访问数据源，然后使用该行集中的表插入字符串。

首先，通过将新 ATL 对象插入到项目中来创建一个表类。 例如，右键单击 "工作区" 窗格中的项目，然后选择 "**新建 ATL 对象**"。 从 "**数据访问**" 类别中，选择 "**使用者**"。 创建类型为**Table**的使用者对象。 （选择**表**直接从表创建行集; 选择**命令**会通过 SQL 命令创建行集。）选择一个数据源，并指定要通过其访问该数据源的表。 如果调用使用者对象**CCustomerTable**，则需实现插入代码，如下所示：

[!code-cpp[NVC_OLEDB_Consumer#10](../../data/oledb/codesnippet/cpp/crowset-insert_1.cpp)]

## <a name="crowsetissamerow"></a><a name="issamerow"></a>CRowset：： IsSameRow

将指定行与当前行进行比较。

### <a name="syntax"></a>语法

```cpp
HRESULT IsSameRow(HROW hRow) const throw();
```

#### <a name="parameters"></a>parameters

*hRow*<br/>
中要与当前行进行比较的行的句柄。

### <a name="return-value"></a>返回值

标准的 HRESULT。 S_OK 指示行是相同的。 有关其他值，请参阅 Windows SDK 中*OLE DB 程序员参考*中的[IRowsetIndentity：： IsSameRow](/previous-versions/windows/desktop/ms719629(v=vs.85)) 。

## <a name="crowsetmovefirst"></a><a name="movefirst"></a>CRowset：： MoveFirst

将光标移至初始位置，并检索初始行。

### <a name="syntax"></a>语法

```cpp
HRESULT MoveFirst() throw();
```

### <a name="return-value"></a>返回值

标准的 HRESULT。

### <a name="remarks"></a>备注

调用[IRowset：： RestartPosition](/previous-versions/windows/desktop/ms712877(v=vs.85))将下一个提取位置重新定位到初始位置（创建行集时的下一个提取位置的位置）并检索初始行。

## <a name="crowsetmovelast"></a><a name="movelast"></a>CRowset：： MoveLast

将光标移到最后一行。

### <a name="syntax"></a>语法

```cpp
HRESULT MoveLast() throw();
```

### <a name="return-value"></a>返回值

标准的 HRESULT。

### <a name="remarks"></a>备注

调用[IRowset：： RestartPosition](/previous-versions/windows/desktop/ms712877(v=vs.85))将下一个提取位置重新定位到最后一个位置并检索最后一行。

此方法要求在对包含行集的表或命令调用 `Open` 之前，将 `DBPROP_CANSCROLLBACKWARDS` 设置为 VARIANT_TRUE。 （为了获得更好的性能，你还可以将 `DBPROP_QUICKRESTART` 设置为 VARIANT_TRUE。）

## <a name="crowsetmovenext"></a><a name="movenext"></a>CRowset：： MoveNext

将光标移动到下一条记录。

### <a name="syntax"></a>语法

```cpp
HRESULT MoveNext() throw();

HRESULT MoveNext(LONG lSkip,
   bool bForward= true) throw();
```

#### <a name="parameters"></a>parameters

*lSkip*<br/>
中提取之前要跳过的行数。

*bForward*<br/>
中传递**true**以便前进到下一条记录，设置为**false**则向后移动。

### <a name="return-value"></a>返回值

标准的 HRESULT。 当到达行集的末尾时，将返回 DB_S_ENDOFROWSET。

### <a name="remarks"></a>备注

从 `CRowset` 对象中提取下一个顺序行，并记住上一个位置。 您也可以选择跳过*lSkip*行或向后移动。

此方法要求在对包含行集的表或命令调用 `Open` 之前设置以下属性：

- 如果*lSkip* < 0，则必须 VARIANT_TRUE `DBPROP_CANSCROLLBACKWARDS`

- 如果*bForward* = false，则必须 VARIANT_TRUE `DBPROP_CANFETCHBACKWARDS`

否则（如果*lSkip* > = 0， *bForward* = true），则不需要设置任何其他属性。

## <a name="crowsetmoveprev"></a><a name="moveprev"></a>CRowset：： MovePrev

将光标移动到上一条记录。

### <a name="syntax"></a>语法

```cpp
HRESULT MovePrev() throw();
```

### <a name="return-value"></a>返回值

标准的 HRESULT。

### <a name="remarks"></a>备注

此方法要求在对包含行集的表或命令调用 `Open` 之前，将 `DBPROP_CANFETCHBACKWARDS` 或 `DBPROP_CANSCROLLBACKWARDS` 设置为 VARIANT_TRUE。

## <a name="crowsetmovetobookmark"></a><a name="movetobookmark"></a>CRowset：： MoveToBookmark

提取书签标记的行，或从该书签指定偏移量（*lSkip*）的行。

### <a name="syntax"></a>语法

```cpp
HRESULT MoveToBookmark(const CBookmarkBase& bookmark,
   LONG lSkip = 0) throw();
```

#### <a name="parameters"></a>parameters

*书签*<br/>
[in] 标记要从其提取数据的位置的书签。

*lSkip*<br/>
[in] 从书签到目标行的行数。 如果*lSkip*为零，则提取的第一行是带有书签的行。 如果*lSkip*为1，则提取的第一行是位于书签的行之后的行。 如果*lSkip*为-1，则提取的第一行是位于书签的行前面的行。

### <a name="return-value"></a>返回值

标准的 HRESULT。

### <a name="remarks"></a>备注

此方法需要 `IRowsetLocate`的可选接口，该接口在所有提供程序上可能不受支持;如果是这种情况，则该方法将返回 E_NOINTERFACE。 还必须将 `DBPROP_IRowsetLocate` 设置为 VARIANT_TRUE 并将 `DBPROP_CANFETCHBACKWARDS` 设置为 VARIANT_TRUE，然后再对包含行集的表或命令调用 `Open`。

有关在使用者中使用书签的信息，请参阅[使用书签](../../data/oledb/using-bookmarks.md)。

## <a name="crowsetmovetoratio"></a><a name="movetoratio"></a>CRowset：： MoveToRatio

从行集中的小数位置开始提取行。

### <a name="syntax"></a>语法

```cpp
HRESULT MoveToRatio(DBCOUNTITEM nNumerator,
   DBCOUNTITEM nDenominator,bool bForward = true) throw();
```

#### <a name="parameters"></a>parameters

*nNumerator*<br/>
中用于确定从中提取数据的小数位置的分子。

*nDenominator*<br/>
中用于确定从中提取数据的分数的分母。

*bForward*<br/>
中指示是向前还是向后移动。 默认值为 forward。

### <a name="return-value"></a>返回值

标准的 HRESULT。

### <a name="remarks"></a>备注

`MoveToRatio` 根据以下公式提取行：

`(nNumerator *  RowsetSize ) / nDenominator`

其中 `RowsetSize` 是行集的大小，以行为单位。 此公式的准确性取决于特定的提供程序。 有关详细信息，请参阅[IRowsetScroll：： GetRowsAtRatio](/previous-versions/windows/desktop/ms709602(v=vs.85))。

此方法需要 `IRowsetScroll`的可选接口，该接口在所有提供程序上可能不受支持;如果是这种情况，则该方法将返回 E_NOINTERFACE。 还必须在对包含行集的表或命令调用 `Open` 之前，将 `DBPROP_IRowsetScroll` 设置为 VARIANT_TRUE。

## <a name="crowsetreleaserows"></a><a name="releaserows"></a>CRowset：： ReleaseRows

调用[IRowset：： ReleaseRows](/previous-versions/windows/desktop/ms719771(v=vs.85))以释放当前的行句柄。

### <a name="syntax"></a>语法

```cpp
HRESULT ReleaseRows() throw();
```

### <a name="return-value"></a>返回值

标准的 HRESULT。

## <a name="crowsetsetdata"></a><a name="setdata"></a>CRowset：： SetData

设置行的一列或多列中的数据值。

### <a name="syntax"></a>语法

```cpp
HRESULT SetData() const throw();

HRESULT SetData(int nAccessor) const throw();
```

#### <a name="parameters"></a>parameters

*nAccessor*<br/>
中要用于访问数据的访问器的编号。

### <a name="return-value"></a>返回值

标准的 HRESULT。

### <a name="remarks"></a>备注

对于不接受参数的 `SetData` 窗体，所有访问器都用于更新。 通常调用 `SetData` 来设置行中的列中的数据值，然后调用[Update](../../data/oledb/crowset-update.md)来传输这些更改。

此方法需要 `IRowsetChange`的可选接口，该接口在所有提供程序上可能不受支持;如果是这种情况，则该方法将返回 E_NOINTERFACE。 还必须在对包含行集的表或命令调用 `Open` 之前，将 `DBPROP_IRowsetChange` 设置为 VARIANT_TRUE。

如果一列或多列不可写，则设置操作可能失败。 修改光标映射以更正此问题。

## <a name="crowsetundo"></a><a name="undo"></a>CRowset：： Undo

撤消自上次提取或[更新](../../data/oledb/crowset-update.md)以来对行所做的任何更改。

### <a name="syntax"></a>语法

```cpp
HRESULT Undo(DBCOUNTITEM* pcRows = NULL,
   HROW* phRow = NULL,
   DBROWSTATUS* pStatus = NULL) throw();
```

#### <a name="parameters"></a>parameters

*pcRows*<br/>
弄一个指针，指向 `Undo` 在需要时返回尝试撤消的行数的位置。

*phRow*<br/>
弄一个指针，指向 `Undo` 在需要时将句柄的数组返回给其尝试撤消的所有行的位置。

*pStatus*<br/>
弄指向 `Undo` 返回行状态值的位置的指针。 如果*pStatus*为 null，则不返回状态。

### <a name="return-value"></a>返回值

标准的 HRESULT。

### <a name="remarks"></a>备注

此方法需要 `IRowsetUpdate`的可选接口，该接口在所有提供程序上可能不受支持;如果是这种情况，则该方法将返回 E_NOINTERFACE。 还必须在对包含行集的表或命令调用 `Open` 之前，将 `DBPROP_IRowsetUpdate` 设置为 VARIANT_TRUE。

## <a name="crowsetupdate"></a><a name="update"></a>CRowset：： Update

传输自上次提取或 `Update` 调用后对当前行进行的任何挂起的更改。

### <a name="syntax"></a>语法

```cpp
HRESULT Update(DBCOUNTITEM* pcRows = NULL,
   HROW* phRow = NULL,
   DBROWSTATUS* pStatus = NULL) throw();
```

#### <a name="parameters"></a>parameters

*pcRows*<br/>
弄一个指针，指向 `Update` 返回其尝试更新的行数（如果需要）的位置。

*phRow*<br/>
弄一个指针，指向 `Update` 返回其尝试更新的行的句柄的位置。 如果*phRow*为 null，则不返回句柄。

*pStatus*<br/>
弄指向 `Update` 返回行状态值的位置的指针。 如果*pStatus*为 null，则不返回状态。

### <a name="return-value"></a>返回值

标准的 HRESULT。

### <a name="remarks"></a>备注

传输自上次提取或更新行后对当前行进行的任何挂起的更改（使用 `Update` 或[UpdateAll](../../data/oledb/crowset-updateall.md)）。 通常调用[SetData](../../data/oledb/crowset-setdata.md)来设置行中的列中的数据值，然后调用 `Update` 传输这些更改。

此方法需要 `IRowsetUpdate`的可选接口，该接口在所有提供程序上可能不受支持;如果是这种情况，则该方法将返回 E_NOINTERFACE。 还必须在对包含行集的表或命令调用 `Open` 之前，将 `DBPROP_IRowsetUpdate` 设置为 VARIANT_TRUE。

## <a name="crowsetupdateall"></a><a name="updateall"></a>CRowset：： UpdateAll

传输自上次提取或 `Update` 调用后对所有行所做的所有挂起的更改。

### <a name="syntax"></a>语法

```cpp
HRESULT UpdateAll(DBCOUNTITEM* pcRows = NULL,
   HROW** pphRow = NULL,
   DBROWSTATUS** ppStatus = NULL) throw();
```

#### <a name="parameters"></a>parameters

*pcRows*<br/>
弄一个指针，指向 `UpdateAll` 返回其尝试更新的行数（如果需要）的位置。

*pphRow*<br/>
弄一个指向内存的指针，该内存用于 `UpdateAll` 返回试图更新的行的句柄。 如果*pphRow*为 null，则不返回句柄。

*ppStatus*<br/>
弄指向 `Update` 返回行状态值的位置的指针。 如果*ppStatus*为 null，则不返回状态。

### <a name="remarks"></a>备注

传输自上次提取[或 `UpdateAll`更新](../../data/oledb/crowset-update.md)这些行后，对所有行进行的任何挂起的更改。 `UpdateAll` 将更新所有已修改的行，而不管是否仍有句柄（请参阅*pphRow*）。

例如，如果使用 `Insert` 在行集中插入五行，则可以调用 `Update` 五次，也可以调用 `UpdateAll` 一次以更新所有行。

此方法需要 `IRowsetUpdate`的可选接口，该接口在所有提供程序上可能不受支持;如果是这种情况，则该方法将返回 E_NOINTERFACE。 还必须在对包含行集的表或命令调用 `Open` 之前，将 `DBPROP_IRowsetUpdate` 设置为 VARIANT_TRUE。

### <a name="return-value"></a>返回值

标准的 HRESULT。

## <a name="see-also"></a>另请参阅

[DBViewer 示例](../../overview/visual-cpp-samples.md)<br/>
[MultiRead 示例](../../overview/visual-cpp-samples.md)<br/>
[MultiRead 特性示例](../../overview/visual-cpp-samples.md)<br/>
[OLE DB 使用者模板](../../data/oledb/ole-db-consumer-templates-cpp.md)<br/>
[OLE DB 使用者模板参考](../../data/oledb/ole-db-consumer-templates-reference.md)
